import{_ as ne,u as ie,j as de,r,w as ue,q as re,o as ce,s as me,a as m,b as v,d as p,e as t,l as o,v as d,m as y,t as f,n as N,h as D,y as ve,z as pe,x as fe}from"./index-4af1a839.js";import{u as he}from"./dataUser-fe915d66.js";import{d as M,a as _e}from"./day-a01efc22.js";const n=T=>(ve("data-v-2efbbea4"),T=T(),pe(),T),be={class:"grid"},ye={class:"col-12"},De={class:"card"},Ie={class:"my-2"},Ve={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},xe=n(()=>t("h5",{class:"m-0"},"Gestión de usuarios",-1)),ge={class:"block mt-2 md:mt-0 p-input-icon-left"},we=n(()=>t("i",{class:"pi pi-search"},null,-1)),Ce=n(()=>t("span",{class:"p-column-title"},"DNI",-1)),Se=n(()=>t("span",{class:"p-column-title"},"Apellidos",-1)),Te=n(()=>t("span",{class:"p-column-title"},"Nombre",-1)),ke=n(()=>t("span",{class:"p-column-title"},"Fecha Nacimiento",-1)),Ue=n(()=>t("span",{class:"p-column-title"},"Teléfono",-1)),Ne={class:"field"},Me=n(()=>t("label",{class:"mb-3"},"Tipo de documento",-1)),Pe={class:"formgrid grid"},Ye={class:"field-radiobutton col-4"},qe=n(()=>t("label",{for:"dni"},"DNI",-1)),Be={class:"field-radiobutton col-4"},Fe=n(()=>t("label",{for:"ce"},"CE",-1)),Ae={class:"field-radiobutton col-4"},Ee=n(()=>t("label",{for:"pasaport"},"Pasaporte",-1)),$e={class:"field"},Le={for:"dni"},ze={key:0,class:"p-invalid"},je={class:"field"},Re=n(()=>t("label",{for:"name"},"Nombre",-1)),Ge={key:0,class:"p-invalid"},Oe={class:"field"},Ke=n(()=>t("label",{for:"name"},"Apellidos",-1)),Ze={key:0,class:"p-invalid"},He={class:"formgrid grid"},Je={class:"field col"},Qe=n(()=>t("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),We={key:0,class:"p-invalid"},Xe={class:"field col"},ea=n(()=>t("label",{for:"phone"},"Teléfono",-1)),aa={key:0,class:"p-invalid"},la={class:"formgrid grid"},sa={class:"field col"},ta=n(()=>t("label",{for:"sex"},"Sexo",-1)),oa={class:"field col"},na=n(()=>t("label",{for:"role"},"Estado Civil",-1)),ia={class:"flex align-items-center justify-content-center"},da=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ua={key:0},ra={class:"flex align-items-center justify-content-center"},ca=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ma={key:0},va={__name:"Patients",setup(T){const I=ie(),E=de(),x=he(),F=r(null),g=r(!0),c=r([]),e=r({}),V=r(!1),w=r(!1),C=r(!1),h=r(null),P=r(null),k=r({}),u=r(!1),$=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),L=r([{name:"Soltero",code:"Soltero"},{name:"Casado",code:"Casado"},{name:"Viudo",code:"Viudo"},{name:"Divorciado",code:"Divorciado"}]);ue([()=>e.value.dni],async([s])=>{U(s)&&e.value.documentType==="DNI"&&z(s)});const z=async s=>{const a=await E.searchbydni(s);a?(e.value.name=(a==null?void 0:a.nombres)||"",e.value.surnames=(a==null?void 0:a.apellidop)+" "+(a==null?void 0:a.apellidom),I.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.dni="",e.value.name="",e.value.surnames="",I.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},Y=s=>/^[0-9]{9}$/.test(s),U=s=>e.value.documentType==="DNI"?(g.value=!0,/^\d{8}$/.test(s)):e.value.documentType==="CE"?(g.value=!1,/^\d{9}$/.test(s)):e.value.documentType==="Pasaporte"?(g.value=!1,/^[A-Za-z0-9]{5,20}$/.test(s)):!0;re(()=>{ae()});const j=`listapacientes-${M(new Date,"DD-MM-YYYY")}`;ce(async()=>{await x.getPatients().then(s=>{F.value=s.flatMap(a=>[{accessId:a.accessId,user:a.user},...(a.user.dependents||[]).map(i=>({accessId:i.accessId,user:i}))])}),F.value.forEach(s=>{const a=s.user;let _=M(a.birthDate,"DD MMMM YYYY");a.birthDate=_,a.accessId=s.accessId,c.value.push(a)})});const R=()=>{e.value={accessId:null,address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null},u.value=!1,V.value=!0},G=()=>{V.value=!1,u.value=!1},O=()=>{const s=e.value;return s.name&&s.name.trim()&&s.surnames&&s.dni&&s.birthDate&&s.sex&&U(s.dni)&&Y(s.phone)},K=async()=>{const s={address:e.value.address,birthDate:_e(e.value.birthDate),civilStatus:e.value.civilStatus,dni:e.value.dni,documentType:e.value.documentType,email:e.value.email,name:e.value.name,phone:e.value.phone,photo:e.value.photo,sex:e.value.sex,surnames:e.value.surnames,access:{username:`${e.value.dni}`,password:e.value.dni,roleId:4}};if(e.value.accessId||e.value.dependentId){const a=c.value.findIndex(_=>_.accessId===e.value.accessId);if(a!==-1){if(e.value.accessId&&(s.access.accessId=e.value.accessId,s.userId=e.value.userId,await x.updatePatient(s.dni,s.access.accessId,s)),e.value.dependentId){s.dependentId=e.value.dependentId;const{access:_,...i}=s;await fe(e.value.dependentId,i)}e.value.birthDate=M(e.value.birthDate,"DD MMMM YYYY"),c.value[a]=e.value,I.add({severity:"success",summary:"Éxito",detail:"Paciente Actualizado",life:3e3})}}else{const a=await x.addUsers(s);e.value.accessId=a.access[0].accessId,e.value.status="offline",e.value.birthDate=M(e.value.birthDate,"DD MMMM YYYY"),c.value.push(e.value),I.add({severity:"success",summary:"Éxito",detail:"Paciente Registrado",life:3e3})}V.value=!1,e.value={},u.value=!1},Z=async()=>{u.value=!0,O()&&K()},H=s=>{e.value={...s},e.value.birthDate=new Date(e.value.birthDate),V.value=!0},J=s=>{e.value=s,w.value=!0},Q=async()=>{e.value.accessId==null?(c.value=c.value.filter(s=>s.dni!==e.value.dni),await x.deleteUserDependents(e.value.dependentId)):(c.value=c.value.filter(s=>s.accessId!==e.value.accessId),await x.disableUser(e.value.accessId)),w.value=!1,e.value={},I.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},W=()=>{console.log(P.value),P.value.exportCSV()},X=()=>{C.value=!0},ee=()=>{c.value=c.value.filter(a=>!h.value.includes(a)),h.value.map(a=>a.dni).forEach(async a=>{console.log(a)}),C.value=!1,h.value=null,I.add({severity:"success",summary:"Successful",detail:"Pacientes deshabilitados",life:3e3})},ae=()=>{k.value={global:{value:null,matchMode:me.CONTAINS}}};return(s,a)=>{const _=m("Toast"),i=m("Button"),le=m("Toolbar"),S=m("InputText"),b=m("Column"),se=m("DataTable"),q=m("RadioButton"),te=m("Calendar"),A=m("Dropdown"),B=m("Dialog");return v(),p("div",be,[t("div",ye,[t("div",De,[o(_),o(le,{class:"mb-4"},{start:d(()=>[t("div",Ie,[o(i,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:R}),o(i,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:X,disabled:!h.value||!h.value.length},null,8,["disabled"])])]),end:d(()=>[o(i,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:a[0]||(a[0]=l=>W(l))})]),_:1}),o(se,{ref_key:"dt",ref:P,value:c.value,selection:h.value,"onUpdate:selection":a[2]||(a[2]=l=>h.value=l),dataKey:"dni",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Pacientes",responsiveLayout:"scroll",exportFilename:j},{header:d(()=>[t("div",Ve,[xe,t("span",ge,[we,o(S,{modelValue:k.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=l=>k.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[o(b,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(b,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ce,y(" "+f(l.data.dni),1)]),_:1}),o(b,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:d(l=>[Se,y(" "+f(l.data.surnames),1)]),_:1}),o(b,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Te,y(" "+f(l.data.name),1)]),_:1}),o(b,{field:"roleName",header:"Fecha de Nacimiento",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[ke,y(" "+f(l.data.birthDate),1)]),_:1}),o(b,{field:"status",header:"Teléfono",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ue,y(" "+f(l.data.phone),1)]),_:1}),o(b,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:d(l=>[o(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:oe=>H(l.data)},null,8,["onClick"]),o(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:oe=>J(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(B,{visible:V.value,"onUpdate:visible":a[13]||(a[13]=l=>V.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:d(()=>[o(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:G}),o(i,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Z})]),default:d(()=>[t("div",Ne,[Me,t("div",Pe,[t("div",Ye,[o(q,{id:"dni",name:"option",value:"DNI",modelValue:e.value.documentType,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.documentType=l)},null,8,["modelValue"]),qe]),t("div",Be,[o(q,{id:"ce",name:"option",value:"CE",modelValue:e.value.documentType,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.documentType=l)},null,8,["modelValue"]),Fe]),t("div",Ae,[o(q,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.documentType,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ee])])]),t("div",$e,[t("label",Le,f(e.value.documentType),1),o(S,{id:"name",modelValue:e.value.dni,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:N({"p-invalid":u.value&&!e.value.dni||!U(e.value.dni)})},null,8,["modelValue","class"]),u.value&&!e.value.dni||!U(e.value.dni)?(v(),p("small",ze,f(e.value.documentType)+" es requerido o formato inválido",1)):D("",!0)]),t("div",je,[Re,o(S,{disabled:g.value,id:"name",modelValue:e.value.name,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:N({"p-invalid":u.value&&!e.value.name})},null,8,["disabled","modelValue","class"]),u.value&&!e.value.name?(v(),p("small",Ge,"Nombre es requerido.")):D("",!0)]),t("div",Oe,[Ke,o(S,{disabled:g.value,id:"name",modelValue:e.value.surnames,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:N({"p-invalid":u.value&&!e.value.surnames})},null,8,["disabled","modelValue","class"]),u.value&&!e.value.surnames?(v(),p("small",Ze,"Apellido es requerido.")):D("",!0)]),t("div",He,[t("div",Je,[Qe,o(te,{showIcon:!0,showButtonBar:!0,modelValue:e.value.birthDate,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),u.value&&!e.value.birthDate?(v(),p("small",We,"Fecha de nacimiento es requerido.")):D("",!0)]),t("div",Xe,[ea,o(S,{id:"phone",modelValue:e.value.phone,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.phone=l),modelModifiers:{trim:!0},class:N({"p-invalid":u.value&&!e.value.phone||!Y(e.value.phone)})},null,8,["modelValue","class"]),u.value&&!e.value.phone||!Y(e.value.phone)?(v(),p("small",aa," Teléfono es requerido o formato inválido")):D("",!0)])]),t("div",la,[t("div",sa,[ta,o(A,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.sex=l),options:$.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),t("div",oa,[na,o(A,{id:"civilStatus",modelValue:e.value.civilStatus,"onUpdate:modelValue":a[12]||(a[12]=l=>e.value.civilStatus=l),options:L.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),o(B,{visible:w.value,"onUpdate:visible":a[15]||(a[15]=l=>w.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[14]||(a[14]=l=>w.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:d(()=>[t("div",ia,[da,e.value?(v(),p("span",ua,[y("¿Estás seguro de que quieres eliminar "),t("b",null,f(e.value.name),1),y("?")])):D("",!0)])]),_:1},8,["visible"]),o(B,{visible:C.value,"onUpdate:visible":a[17]||(a[17]=l=>C.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[16]||(a[16]=l=>C.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ee})]),default:d(()=>[t("div",ra,[ca,e.value?(v(),p("span",ma,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):D("",!0)])]),_:1},8,["visible"])])])])}}},_a=ne(va,[["__scopeId","data-v-2efbbea4"]]);export{_a as default};
