import{_ as de,p as ce,u as me,A as pe,j as ve,r as m,w as _e,q as fe,o as he,s as be,a as d,b as p,d as v,e as a,l as t,v as u,m as x,t as D,n as V,h as _,E as De,y as ye,z as Ie}from"./index-4af1a839.js";import{u as Ve}from"./dataUser-fe915d66.js";import{d as q,a as ge}from"./day-a01efc22.js";const i=C=>(ye("data-v-56263762"),C=C(),Ie(),C),xe={class:"grid"},we={class:"col-12"},Pe={class:"card"},ze={class:"my-2"},Ce={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ke=i(()=>a("h5",{class:"m-0"},"Gestión de Médicos",-1)),Se={class:"block mt-2 md:mt-0 p-input-icon-left"},Ue=i(()=>a("i",{class:"pi pi-search"},null,-1)),Ne=i(()=>a("span",{class:"p-column-title"},"DNI",-1)),Me=i(()=>a("span",{class:"p-column-title"},"Nombre",-1)),Te=i(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),Ee=i(()=>a("span",{class:"p-column-title"},"Especialidad",-1)),qe=i(()=>a("span",{class:"p-column-title"},"Status",-1)),Ae={class:"field"},Be=i(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),Fe={class:"formgrid grid"},Ye={class:"field-radiobutton col-4"},$e=i(()=>a("label",{for:"dni"},"DNI",-1)),Le={class:"field-radiobutton col-4"},Re=i(()=>a("label",{for:"ce"},"CE",-1)),je={class:"field-radiobutton col-4"},Ge=i(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Oe={class:"field"},Ke={for:"dni"},Ze={key:0,class:"p-invalid"},He={class:"field"},Je=i(()=>a("label",{for:"name"},"Nombre",-1)),Qe={key:0,class:"p-invalid"},We={class:"field"},Xe=i(()=>a("label",{for:"surnames"},"Apellidos",-1)),es={key:0,class:"p-invalid"},ss={class:"formgrid grid"},ls={class:"field col"},as=i(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),os={key:0,class:"p-invalid"},ts={class:"field col"},is=i(()=>a("label",{for:"phone"},"Teléfono",-1)),rs={key:0,class:"p-invalid"},us={class:"formgrid grid"},ns={class:"field col"},ds=i(()=>a("label",{for:"sex"},"Sexo",-1)),cs={key:0,class:"p-invalid"},ms={class:"field col"},ps=i(()=>a("label",{for:"status"},"Estado",-1)),vs=i(()=>a("br",null,null,-1)),_s={class:"formgrid grid"},fs={class:"field col"},hs=i(()=>a("label",{for:"cpm"},"CMP",-1)),bs={class:"field col"},Ds=i(()=>a("label",{for:"rne"},"RNE",-1)),ys={class:"field"},Is=i(()=>a("label",{for:"specialization"},"Especialidad",-1)),Vs={key:0,class:"p-invalid"},gs={class:"field"},xs=i(()=>a("label",{for:"personalizedPrice"},"Costo de Consulta",-1)),ws={key:0,class:"p-invalid"},Ps={class:"flex align-items-center justify-content-center"},zs=i(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Cs={key:0},ks={class:"flex align-items-center justify-content-center"},Ss=i(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Us={key:0},Ns={__name:"Doctors",setup(C){const A=ce(),f=me(),B=pe(),F=ve(),w=Ve(),h=m(null),e=m({user:{dni:null}});_e([()=>e.value.user.dni],async([o])=>{S(o)&&e.value.user.documentType==="DNI"&&Y(o)});const Y=async o=>{const s=await F.searchbydni(o);s?(e.value.user.name=(s==null?void 0:s.nombres)||"",e.value.user.surnames=(s==null?void 0:s.apellidop)+" "+(s==null?void 0:s.apellidom),f.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.user.dni="",e.value.user.name="",e.value.user.surnames="",f.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},g=m(!1),$=m(!1),P=m(!1),z=m(!1),y=m(null),T=m(null),k=m({}),r=m(!1),L=m([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),R=o=>{console.log(o),De.setItem("doctor",o),A.push("/timetable")},S=o=>e.value.user.documentType==="DNI"?/^\d{8}$/.test(o):e.value.user.documentType==="CE"?/^\d{9}$/.test(o):e.value.user.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(o):!0,U=o=>/^[0-9]{9}$/.test(o);fe(()=>{ae()});const j=`listamedicos-${q(new Date,"DD-MM-YYYY")}`;he(async()=>{await B.getDoctors().then(o=>{h.value=o.map(s=>{let c=q(s.user.birthDate,"DD MMMM YYYY");return s.user.birthDate=c,s})})});const G=()=>{e.value={accessId:null,active:null,createAt:null,lastSession:null,password:null,roleId:null,roleName:null,status:null,user:{address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null,Doctor:{cpm:null,doctorId:null,rne:null,specialization:null,status:!0,userId:null,personalizedPrices:[{personalizedPrice:null,medicalServiceId:1}]}}},r.value=!1,g.value=!0},O=()=>{g.value=!1,$.value=!1,r.value=!1},K=o=>{const s=new Date,c=new Date(o);return s.getFullYear()-c.getFullYear()<18?(f.add({severity:"error",summary:"Error",detail:"Debes ser mayor de edad para registrarte.",life:3e3}),!1):!0},Z=()=>{const o=e.value.user;return o.name&&o.name.trim()&&o.surnames&&o.dni&&o.birthDate&&o.sex&&e.value.user.Doctor.status&&S(o.dni),U(o.phone)},H=async()=>{const o={address:e.value.user.address,birthDate:ge(new Date(e.value.user.birthDate)),civilStatus:e.value.user.civilStatus,dni:e.value.user.dni,documentType:e.value.user.documentType,email:e.value.user.email,name:e.value.user.name,phone:e.value.user.phone,photo:e.value.user.photo,sex:e.value.user.sex,surnames:e.value.user.surnames,access:{username:`${e.value.user.dni}-3`,password:e.value.user.dni,roleId:3},Doctor:{status:e.value.user.Doctor.status,cmp:e.value.user.Doctor.cmp,rne:e.value.user.Doctor.rne,specialization:e.value.user.Doctor.specialization,personalizedPrices:[{personalizedPrice:e.value.user.Doctor.personalizedPrices[0].personalizedPrice,medicalServiceId:1}]}};if(e.value.accessId){const s=h.value.findIndex(c=>c.accessId===e.value.accessId);s!==-1&&(o.access.accessId=e.value.accessId,o.userId=e.value.user.userId,o.Doctor.doctorId=e.value.user.Doctor.doctorId,o.Doctor.personalizedPrices[0].personalizedPriceId=e.value.user.Doctor.personalizedPrices[0].personalizedPriceId,o.Doctor.personalizedPrices[0].doctorId=e.value.user.Doctor.doctorId,await w.updateDoctor(o.dni,o.access.accessId,o.Doctor.doctorId,o.Doctor.personalizedPrices[0].personalizedPriceId,o),h.value[s]=e.value,f.add({severity:"success",summary:"Éxito",detail:"Médico Actualizado",life:3e3}))}else{let s=4;const c=await w.addUsers(o);if(await w.createAccessUser(o.dni,{roleId:s}),c=="Violación de la restricción única."){f.add({severity:"error",summary:"Error",detail:"DNI o CMP ya registrados, corregir",life:3e3});return}else e.value.accessId=c.access[0].accessId,e.value.user.Doctor.doctorId=c.Doctor.doctorId,e.value.status="offline",h.value.push(e.value),f.add({severity:"success",summary:"Éxito",detail:"Médico Registrado",life:3e3})}g.value=!1,e.value={user:{dni:null}}},J=async()=>{r.value=!0,K(e.value.user.birthDate)&&(Z()?H():f.add({severity:"error",summary:"Error",detail:"Ingresar todos los datos correctamente",life:3e3}))},Q=o=>{e.value={...o},g.value=!0},W=o=>{e.value=o,P.value=!0},X=async()=>{h.value=h.value.filter(o=>o.accessId!==e.value.accessId),await w.disableUser(e.value.accessId),P.value=!1,e.value={user:{dni:null}},f.add({severity:"success",summary:"Éxito",detail:"Médico deshabilitado",life:3e3})},ee=()=>{T.value.exportCSV()},se=()=>{z.value=!0},le=()=>{h.value=h.value.filter(s=>!y.value.includes(s)),y.value.map(s=>s.accessId).forEach(async s=>{await w.disableUser(s)}),z.value=!1,y.value=null,f.add({severity:"success",summary:"Éxito",detail:"Médicos deshabilitados",life:3e3})},ae=()=>{k.value={global:{value:null,matchMode:be.CONTAINS}}};return(o,s)=>{const c=d("Toast"),n=d("Button"),oe=d("Toolbar"),b=d("InputText"),I=d("Column"),te=d("DataTable"),N=d("RadioButton"),ie=d("Calendar"),re=d("Dropdown"),ue=d("InputSwitch"),ne=d("InputNumber"),M=d("Dialog");return p(),v("div",xe,[a("div",we,[a("div",Pe,[t(c),t(oe,{class:"mb-4"},{start:u(()=>[a("div",ze,[t(n,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:G}),t(n,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:se,disabled:!y.value||!y.value.length},null,8,["disabled"])])]),end:u(()=>[t(n,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:s[0]||(s[0]=l=>ee(l))})]),_:1}),t(te,{ref_key:"dt",ref:T,value:h.value,selection:y.value,"onUpdate:selection":s[2]||(s[2]=l=>y.value=l),dataKey:"accessId",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Colaboradores",responsiveLayout:"scroll",exportFilename:j},{header:u(()=>[a("div",Ce,[ke,a("span",Se,[Ue,t(b,{modelValue:k.value.global.value,"onUpdate:modelValue":s[1]||(s[1]=l=>k.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:u(()=>[t(I,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(I,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ne,x(" "+D(l.data.user.dni),1)]),_:1}),t(I,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Me,x(" "+D(l.data.user.name),1)]),_:1}),t(I,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Te,x(" "+D(l.data.user.surnames),1)]),_:1}),t(I,{field:"user.doctors.specialization",header:"Especialidad",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ee,x(" "+D(l.data.user.Doctor.specialization),1)]),_:1}),t(I,{field:"status",header:"Status",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[qe,a("span",{class:V("user-badge status-"+(l.data.status?l.data.status.toLowerCase():""))},D(l.data.status),3)]),_:1}),t(I,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:u(l=>[t(n,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:E=>Q(l.data)},null,8,["onClick"]),t(n,{icon:"pi pi-calendar-plus",class:"p-button-rounded p-button-info mr-2",onClick:E=>R(l.data)},null,8,["onClick"]),t(n,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:E=>W(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),t(M,{visible:g.value,"onUpdate:visible":s[17]||(s[17]=l=>g.value=l),style:{width:"500px"},header:"Detalle de Médico",modal:!0,class:"p-fluid"},{footer:u(()=>[t(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:O}),t(n,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:J})]),default:u(()=>[a("div",Ae,[Be,a("div",Fe,[a("div",Ye,[t(N,{id:"dni",name:"option",value:"DNI",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),$e]),a("div",Le,[t(N,{id:"ce",name:"option",value:"CE",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Re]),a("div",je,[t(N,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Ge])])]),a("div",Oe,[a("label",Ke,D(e.value.documentType),1),t(b,{id:"dni",modelValue:e.value.user.dni,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.user.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":r.value&&!e.value.user.dni||!S(e.value.user.dni)})},null,8,["modelValue","class"]),r.value&&!e.value.user.dni||!S(e.value.user.dni)?(p(),v("small",Ze,D(e.value.user.documentType)+" es requerido o formato inválido",1)):_("",!0)]),a("div",He,[Je,t(b,{id:"name",modelValue:e.value.user.name,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.user.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":r.value&&!e.value.user.name})},null,8,["modelValue","class"]),r.value&&!e.value.user.name?(p(),v("small",Qe,"Nombre es requerido.")):_("",!0)]),a("div",We,[Xe,t(b,{id:"surnames",modelValue:e.value.user.surnames,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.user.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":r.value&&!e.value.user.surnames})},null,8,["modelValue","class"]),r.value&&!e.value.user.surnames?(p(),v("small",es,"Apellido es requerido.")):_("",!0)]),a("div",ss,[a("div",ls,[as,t(ie,{showIcon:!0,showButtonBar:!0,modelValue:e.value.user.birthDate,"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.user.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),r.value&&!e.value.birthDate?(p(),v("small",os,"Fecha de nacimiento es requerido.")):_("",!0)]),a("div",ts,[is,t(b,{id:"phone",modelValue:e.value.user.phone,"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.user.phone=l),modelModifiers:{trim:!0},class:V({"p-invalid":r.value&&!e.value.user.phone||!U(e.value.user.phone)})},null,8,["modelValue","class"]),r.value&&!e.value.user.phone||!U(e.value.user.phone)?(p(),v("small",rs," Teléfono es requerido o formato inválido")):_("",!0)])]),a("div",us,[a("div",ns,[ds,t(re,{id:"sex",modelValue:e.value.user.sex,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.user.sex=l),options:L.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"]),r.value&&!e.value.user.sex?(p(),v("small",cs,"Sexo es requerido.")):_("",!0)]),a("div",ms,[ps,vs,t(ue,{id:"status",modelValue:e.value.user.Doctor.status,"onUpdate:modelValue":s[12]||(s[12]=l=>e.value.user.Doctor.status=l),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),a("div",_s,[a("div",fs,[hs,t(b,{id:"cmp",modelValue:e.value.user.Doctor.cmp,"onUpdate:modelValue":s[13]||(s[13]=l=>e.value.user.Doctor.cmp=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),a("div",bs,[Ds,t(b,{id:"rne",modelValue:e.value.user.Doctor.rne,"onUpdate:modelValue":s[14]||(s[14]=l=>e.value.user.Doctor.rne=l),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),a("div",ys,[Is,t(b,{id:"specialization",modelValue:e.value.user.Doctor.specialization,"onUpdate:modelValue":s[15]||(s[15]=l=>e.value.user.Doctor.specialization=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":r.value&&!e.value.user.Doctor.specialization})},null,8,["modelValue","class"]),r.value&&!e.value.user.Doctor.specialization?(p(),v("small",Vs,"Especialidad es requerida.")):_("",!0)]),a("div",gs,[xs,t(ne,{modelValue:e.value.user.Doctor.personalizedPrices[0].personalizedPrice,"onUpdate:modelValue":s[16]||(s[16]=l=>e.value.user.Doctor.personalizedPrices[0].personalizedPrice=l),inputId:"personalizedPrice",mode:"currency",currency:"PEN",locale:"es-PE",required:"true",autofocus:"",class:V({"p-invalid":r.value&&!e.value.user.Doctor.personalizedPrices[0].personalizedPrice})},null,8,["modelValue","class"]),r.value&&!e.value.user.Doctor.personalizedPrices[0].personalizedPrice?(p(),v("small",ws,"Especialidad es requerida.")):_("",!0)])]),_:1},8,["visible"]),t(M,{visible:P.value,"onUpdate:visible":s[19]||(s[19]=l=>P.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[18]||(s[18]=l=>P.value=!1)}),t(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:X})]),default:u(()=>[a("div",Ps,[zs,e.value?(p(),v("span",Cs,[x("¿Estás seguro de que quieres eliminar "),a("b",null,D(e.value.user.name),1),x("?")])):_("",!0)])]),_:1},8,["visible"]),t(M,{visible:z.value,"onUpdate:visible":s[21]||(s[21]=l=>z.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[20]||(s[20]=l=>z.value=!1)}),t(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:le})]),default:u(()=>[a("div",ks,[Ss,e.value?(p(),v("span",Us,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):_("",!0)])]),_:1},8,["visible"])])])])}}},qs=de(Ns,[["__scopeId","data-v-56263762"]]);export{qs as default};
