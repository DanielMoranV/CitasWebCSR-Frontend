import{_ as ie,u as ne,y as de,r as d,m as ue,o as re,p as ce,a as m,b as f,c as h,d as s,e as l,q as n,t as S,j as x,n as V,l as T,w as me,v as ve,x as pe}from"./index-a19affa2.js";import{u as _e}from"./dataUser-b752686d.js";import{d as g}from"./day-a01efc22.js";import{r as fe,u as he}from"./xlsx-04f2268f.js";const r=M=>(ve("data-v-faf3069b"),M=M(),pe(),M),be={class:"grid"},ye={class:"col-12"},Te={class:"card"},ge={class:"my-2"},De={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},we={class:"m-0"},ke={class:"block mt-2 md:mt-0 p-input-icon-left"},Se=r(()=>s("i",{class:"pi pi-search"},null,-1)),xe=r(()=>s("span",{class:"p-column-title"},"Día",-1)),Ie=r(()=>s("span",{class:"p-column-title"},"Inicio",-1)),Ce=r(()=>s("span",{class:"p-column-title"},"Fin",-1)),Ue=r(()=>s("span",{class:"p-column-title"},"Capacidad",-1)),Ve={class:"field"},Me=r(()=>s("label",{for:"dni"},"Días",-1)),qe={key:0,class:"p-invalid"},Fe={class:"formgrid grid"},Ne={class:"field col"},Ye=r(()=>s("label",{for:"startTime"},"Hora Inicio",-1)),He={key:0,class:"p-invalid"},Pe={class:"field col"},Be=r(()=>s("label",{for:"endTime"},"Hora Fin",-1)),Ae={key:0,class:"p-invalid"},Le={class:"field"},je=r(()=>s("label",{for:"interval"},"Duracion por consulta (minutos)",-1)),Re={key:0,class:"p-invalid"},$e={class:"formgrid grid"},ze={class:"field col"},Ee=r(()=>s("label",{for:"capacity"},"Capacidad",-1)),Oe={key:0,class:"p-invalid"},Ge={class:"field col"},Ke=r(()=>s("p",null,"Disponible",-1)),Je={class:"flex align-items-center justify-content-center"},Qe=r(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),We={key:0},Xe={class:"flex align-items-center justify-content-center"},Ze=r(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ea={key:0},aa={__name:"Timetable",setup(M){const Y=ne(),j=_e(),q=de(),R=d(null),D=d(null),H=d(null),a=d(null),p=d(null),F=d(null),b=d({}),w=d(!1),I=d(!1),C=d(!1),y=d(null),P=d(null),N=d({}),u=d(!1);ue(()=>{le()});const z=`listcolaborator-${g(new Date,"DD-MM-YYYY")}`;re(async()=>{D.value=await q.doctor,R.value=D.value.user.name+" "+D.value.user.surnames,await q.getDoctorSchedule(D.value.user.Doctor.doctorId).then(o=>{H.value=o.map(e=>{let c=g(e.startTime,"hh:mm A"),i=g(e.endTime,"hh:mm A"),v=g(e.day,"DD MMMM YYYY");return e.startTime=c,e.endTime=i,e.day=v,e})})});const E=()=>{a.value={day:null,startTime:null,endTime:null,interval:null,capacity:null,availableSchedule:!0,doctorId:D.value.user.Doctor.doctorId},p.value=null,u.value=!1,w.value=!0,me([()=>a.value.startTime,()=>a.value.endTime,()=>a.value.interval],([o,e,c])=>{if(o!==null&&e!==null&&c!==null){const i=new Date(o),v=new Date(e),k=c,U=(v-i)/(1e3*60);a.value.capacity=Math.floor(U/k)}else a.value.capacity=null})},O=()=>{w.value=!1,u.value=!1},G=()=>a.value.startTime&&a.value.endTime&&a.value.interval&&a.value.capacity&&a.value.availableSchedule&&a.value.doctorId&&p.value,K=async()=>{if(console.log(a.value),console.log(p.value),a.value.scheduleId)console.log("voy a editar");else{for(const o of p.value){const e={...a.value,startTime:new Date(o.setHours(a.value.startTime.getHours(),a.value.startTime.getMinutes())),endTime:new Date(o.setHours(a.value.endTime.getHours(),a.value.endTime.getMinutes())),day:o};await q.addDoctorSchedule(e)}Y.add({severity:"success",summary:"Éxito",detail:"Dias y turnos de citas generados correctamente",life:3e3})}await q.getDoctorSchedule(D.value.user.Doctor.doctorId).then(o=>{H.value=o.map(e=>{let c=g(e.startTime,"hh:mm A"),i=g(e.endTime,"hh:mm A"),v=g(e.day,"DD MMMM YYYY");return e.startTime=c,e.endTime=i,e.day=v,e})}),w.value=!1,a.value={}},J=async()=>{u.value=!0,G()&&K()},Q=o=>{a.value={...o},p.value=a.value.day,w.value=!0},W=o=>{b.value=o,I.value=!0},X=async()=>{F.value=F.value.filter(o=>o.accessId!==b.value.accessId),await j.disableUser(b.value.accessId),I.value=!1,b.value={},Y.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},Z=()=>{console.log(P.value),P.value.exportCSV()},ee=o=>{const e=o.files[0],c=new FileReader;c.onload=i=>{const v=new Uint8Array(i.target.result),k=fe(v,{type:"array"}),U=k.SheetNames[0],_=k.Sheets[U],B=he.sheet_to_json(_);console.log(B)},c.readAsArrayBuffer(e)},ae=()=>{C.value=!0},te=()=>{F.value=F.value.filter(e=>!y.value.includes(e)),y.value.map(e=>e.accessId).forEach(async e=>{await j.disableUser(e)}),C.value=!1,y.value=null,Y.add({severity:"success",summary:"Successful",detail:"Colaboradores deshabilitados",life:3e3})},le=()=>{N.value={global:{value:null,matchMode:ce.CONTAINS}}};return(o,e)=>{const c=m("Toast"),i=m("Button"),v=m("FileUpload"),k=m("Toolbar"),U=m("InputText"),_=m("Column"),B=m("DataTable"),A=m("Calendar"),$=m("InputNumber"),se=m("InputSwitch"),L=m("Dialog");return f(),h("div",be,[s("div",ye,[s("div",Te,[l(c),l(k,{class:"mb-4"},{start:n(()=>[s("div",ge,[l(i,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:E}),l(i,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:ae,disabled:!y.value||!y.value.length},null,8,["disabled"])])]),end:n(()=>[l(v,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:ee}),l(i,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:e[0]||(e[0]=t=>Z(t))})]),_:1}),l(B,{ref_key:"dt",ref:P,value:H.value,selection:y.value,"onUpdate:selection":e[2]||(e[2]=t=>y.value=t),dataKey:"schedulesId",paginator:!0,rows:10,filters:N.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Horarios",responsiveLayout:"scroll",exportFilename:z},{header:n(()=>[s("div",De,[s("h5",we,"Gestión de Horarios Dr "+S(R.value),1),s("span",ke,[Se,l(U,{modelValue:N.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=t=>N.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:n(()=>[l(_,{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(_,{field:"day",header:"Día",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(t=>[xe,x(" "+S(t.data.day),1)]),_:1}),l(_,{field:"startTime",header:"Inicio",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(t=>[Ie,x(" "+S(t.data.startTime),1)]),_:1}),l(_,{field:"endTime",header:"Fin",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(t=>[Ce,x(" "+S(t.data.endTime),1)]),_:1}),l(_,{field:"capacity",header:"Capacidad",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(t=>[Ue,x(" "+S(t.data.capacity),1)]),_:1}),l(_,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:n(t=>[l(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:oe=>Q(t.data)},null,8,["onClick"]),l(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:oe=>W(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),l(L,{visible:w.value,"onUpdate:visible":e[9]||(e[9]=t=>w.value=t),style:{width:"500px"},header:"Horario de consultas",modal:!0,class:"p-fluid"},{footer:n(()=>[l(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:O}),l(i,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:J})]),default:n(()=>[s("div",Ve,[Me,l(A,{showIcon:!0,showButtonBar:!0,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),dateFormat:"dd/mm/yy",required:"true",selectionMode:"multiple",class:V({"p-invalid":u.value&&!a.value.daysSchedule}),minDate:new Date},null,8,["modelValue","class","minDate"]),u.value&&!p.value?(f(),h("small",qe,"Días es requerido.")):T("",!0)]),s("div",Fe,[s("div",Ne,[Ye,l(A,{id:"calendar-timeonly",modelValue:a.value.startTime,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.startTime=t),timeOnly:"",hourFormat:"12",required:"true",showIcon:!0,manualInput:!0,class:V({"p-invalid":u.value&&!a.value.startTime})},null,8,["modelValue","class"]),u.value&&!a.value.startTime?(f(),h("small",He,"Hora inicio es requerido.")):T("",!0)]),s("div",Pe,[Be,l(A,{id:"calendar-timeonly",modelValue:a.value.endTime,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.endTime=t),timeOnly:"",hourFormat:"12",required:"true",showIcon:!0,manualInput:!0,class:V({"p-invalid":u.value&&!a.value.endTime})},null,8,["modelValue","class"]),u.value&&!a.value.endTime?(f(),h("small",Ae,"Hora inicio es requerido.")):T("",!0)])]),s("div",Le,[je,l($,{id:"interval",modelValue:a.value.interval,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.interval=t),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":u.value&&!a.value.interval})},null,8,["modelValue","class"]),u.value&&!a.value.interval?(f(),h("small",Re,"Intervalo es requerido.")):T("",!0)]),s("div",$e,[s("div",ze,[Ee,l($,{id:"capacity",modelValue:a.value.capacity,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.capacity=t),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":u.value&&!a.value.capacity}),disabled:!0},null,8,["modelValue","class"]),u.value&&!a.value.capacity?(f(),h("small",Oe,"Capacidad es requerido.")):T("",!0)]),s("div",Ge,[Ke,l(se,{modelValue:a.value.availableSchedule,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.availableSchedule=t)},null,8,["modelValue"])])])]),_:1},8,["visible"]),l(L,{visible:I.value,"onUpdate:visible":e[11]||(e[11]=t=>I.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[l(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[10]||(e[10]=t=>I.value=!1)}),l(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:X})]),default:n(()=>[s("div",Je,[Qe,b.value?(f(),h("span",We,[x("¿Estás seguro de que quieres eliminar "),s("b",null,S(b.value.user.name),1),x("?")])):T("",!0)])]),_:1},8,["visible"]),l(L,{visible:C.value,"onUpdate:visible":e[13]||(e[13]=t=>C.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[l(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[12]||(e[12]=t=>C.value=!1)}),l(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:te})]),default:n(()=>[s("div",Xe,[Ze,b.value?(f(),h("span",ea,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):T("",!0)])]),_:1},8,["visible"])])])])}}},ia=ie(aa,[["__scopeId","data-v-faf3069b"]]);export{ia as default};
