import{_ as te,u as ne,r,m as ue,o as ie,p as de,a as c,b as _,c as f,d as a,e as o,q as u,j as g,t as h,n as U,l as x,v as re,x as ce}from"./index-0df8eb20.js";import{u as me}from"./dataUser-cdcc4b67.js";import{d as $,a as pe}from"./day-a01efc22.js";import{r as ve,u as _e}from"./xlsx-04f2268f.js";const n=k=>(re("data-v-e3148803"),k=k(),ce(),k),fe={class:"grid"},he={class:"col-12"},be={class:"card"},ye={class:"my-2"},xe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ie=n(()=>a("h5",{class:"m-0"},"Gestión de usuarios",-1)),ge={class:"block mt-2 md:mt-0 p-input-icon-left"},we=n(()=>a("i",{class:"pi pi-search"},null,-1)),Ve=n(()=>a("span",{class:"p-column-title"},"DNI",-1)),De=n(()=>a("span",{class:"p-column-title"},"Nombre",-1)),Ue=n(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),ke=n(()=>a("span",{class:"p-column-title"},"Rol",-1)),Ce=n(()=>a("span",{class:"p-column-title"},"Status",-1)),Se={class:"field"},Ne=n(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),Te={class:"formgrid grid"},Me={class:"field-radiobutton col-4"},Ae=n(()=>a("label",{for:"dni"},"DNI",-1)),Pe={class:"field-radiobutton col-4"},qe=n(()=>a("label",{for:"ce"},"CE",-1)),Fe={class:"field-radiobutton col-4"},Be=n(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Re={class:"field"},Le={for:"dni"},$e={key:0,class:"p-invalid"},Ye={class:"field"},Ee=n(()=>a("label",{for:"name"},"Nombre",-1)),je={key:0,class:"p-invalid"},ze={class:"field"},Ge=n(()=>a("label",{for:"name"},"Apellidos",-1)),Oe={key:0,class:"p-invalid"},Ke={class:"formgrid grid"},Ze={class:"field col"},He=n(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),Je={key:0,class:"p-invalid"},Qe={class:"field col"},We=n(()=>a("label",{for:"phone"},"Teléfono",-1)),Xe={key:0,class:"p-invalid"},es={class:"formgrid grid"},ss={class:"field col"},ls=n(()=>a("label",{for:"sex"},"Sexo",-1)),as={class:"field col"},os=n(()=>a("label",{for:"role"},"Rol",-1)),ts={class:"flex align-items-center justify-content-center"},ns=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),us={key:0},is={class:"flex align-items-center justify-content-center"},ds=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),rs={key:0},cs={__name:"Users",setup(k){const C=ne(),w=me(),m=r(null),e=r({}),I=r(!1),V=r(!1),D=r(!1),b=r(null),T=r(null),S=r({}),i=r(!1),Y=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),E=r([{name:"Administrador",code:1},{name:"Admisionista",code:2}]),M=r({1:"Administrador",2:"Admisionista"}),A=t=>/^[0-9]{9}$/.test(t),P=t=>e.value.user.documentType==="DNI"?/^\d{8}$/.test(t):e.value.user.documentType==="CE"?/^\d{9}$/.test(t):e.value.user.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(t):!0;ue(()=>{le()});const j=`listcolaborator-${$(new Date,"DD-MM-YYYY")}`;ie(async()=>{await w.getCollaborators().then(t=>{m.value=t.map(s=>{let v=$(s.user.birthDate,"DD MMMM YYYY");return s.user.birthDate=v,s.roleName=M.value[s.roleId],s})}),console.log(m.value)});const z=()=>{e.value={accessId:null,active:null,createAt:null,lastSession:null,password:null,roleId:null,roleName:null,status:null,user:{address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null}},i.value=!1,I.value=!0},G=()=>{I.value=!1,i.value=!1},O=()=>{const t=e.value.user;return t.name&&t.name.trim()&&t.surnames&&t.dni&&t.birthDate&&t.sex&&P(t.dni)&&A(t.phone)},K=async()=>{const t={address:e.value.user.address,birthDate:pe(new Date(e.value.user.birthDate)),civilStatus:e.value.user.civilStatus,dni:e.value.user.dni,documentType:e.value.user.documentType,email:e.value.user.email,name:e.value.user.name,phone:e.value.user.phone,photo:e.value.user.photo,sex:e.value.user.sex,surnames:e.value.user.surnames,access:{username:`${e.value.user.dni}-${e.value.roleId}`,password:e.value.user.dni,roleId:e.value.roleId}};if(e.value.accessId){const s=m.value.findIndex(v=>v.accessId===e.value.accessId);s!==-1&&(t.access.accessId=e.value.accessId,t.userId=e.value.user.userId,await w.updateUser(t.dni,t.access.accessId,t),e.value.roleName=M.value[e.value.roleId],m.value[s]=e.value,C.add({severity:"success",summary:"Éxito",detail:"Colaborador Actualizado",life:3e3}))}else{const s=await w.addUsers(t);e.value.accessId=s.access[0].accessId,e.value.roleName=M.value[e.value.roleId],e.value.status="offline",m.value.push(e.value),C.add({severity:"success",summary:"Éxito",detail:"Colaborador Registrado",life:3e3})}I.value=!1,e.value={},i.value=!1},Z=async()=>{i.value=!0,O()&&K()},H=t=>{e.value={...t},I.value=!0},J=t=>{e.value=t,V.value=!0},Q=async()=>{m.value=m.value.filter(t=>t.accessId!==e.value.accessId),await w.disableUser(e.value.accessId),V.value=!1,e.value={},C.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},W=()=>{console.log(T.value),T.value.exportCSV()},X=t=>{const s=t.files[0],v=new FileReader;v.onload=d=>{const q=new Uint8Array(d.target.result),N=ve(q,{type:"array"}),y=N.SheetNames[0],p=N.Sheets[y],F=_e.sheet_to_json(p);console.log(F)},v.readAsArrayBuffer(s)},ee=()=>{D.value=!0},se=()=>{m.value=m.value.filter(s=>!b.value.includes(s)),b.value.map(s=>s.accessId).forEach(async s=>{await w.disableUser(s)}),D.value=!1,b.value=null,C.add({severity:"success",summary:"Successful",detail:"Colaboradores deshabilitados",life:3e3})},le=()=>{S.value={global:{value:null,matchMode:de.CONTAINS}}};return(t,s)=>{const v=c("Toast"),d=c("Button"),q=c("FileUpload"),N=c("Toolbar"),y=c("InputText"),p=c("Column"),F=c("DataTable"),B=c("RadioButton"),ae=c("Calendar"),L=c("Dropdown"),R=c("Dialog");return _(),f("div",fe,[a("div",he,[a("div",be,[o(v),o(N,{class:"mb-4"},{start:u(()=>[a("div",ye,[o(d,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:z}),o(d,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:ee,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:u(()=>[o(q,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:X}),o(d,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:s[0]||(s[0]=l=>W(l))})]),_:1}),o(F,{ref_key:"dt",ref:T,value:m.value,selection:b.value,"onUpdate:selection":s[2]||(s[2]=l=>b.value=l),dataKey:"accessId",paginator:!0,rows:10,filters:S.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Colaboradores",responsiveLayout:"scroll",exportFilename:j},{header:u(()=>[a("div",xe,[Ie,a("span",ge,[we,o(y,{modelValue:S.value.global.value,"onUpdate:modelValue":s[1]||(s[1]=l=>S.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:u(()=>[o(p,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(p,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ve,g(" "+h(l.data.user.dni),1)]),_:1}),o(p,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[De,g(" "+h(l.data.user.name),1)]),_:1}),o(p,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ue,g(" "+h(l.data.user.surnames),1)]),_:1}),o(p,{field:"roleName",header:"Rol",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[ke,g(" "+h(l.data.roleName),1)]),_:1}),o(p,{field:"status",header:"Status",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ce,a("span",{class:U("user-badge status-"+(l.data.status?l.data.status.toLowerCase():""))},h(l.data.status),3)]),_:1}),o(p,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:u(l=>[o(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:oe=>H(l.data)},null,8,["onClick"]),o(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:oe=>J(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(R,{visible:I.value,"onUpdate:visible":s[13]||(s[13]=l=>I.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:u(()=>[o(d,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:G}),o(d,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Z})]),default:u(()=>[a("div",Se,[Ne,a("div",Te,[a("div",Me,[o(B,{id:"dni",name:"option",value:"DNI",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Ae]),a("div",Pe,[o(B,{id:"ce",name:"option",value:"CE",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),qe]),a("div",Fe,[o(B,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Be])])]),a("div",Re,[a("label",Le,h(e.value.user.documentType),1),o(y,{id:"name",modelValue:e.value.user.dni,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.user.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.dni||!P(e.value.user.dni)})},null,8,["modelValue","class"]),i.value&&!e.value.user.dni||!P(e.value.user.dni)?(_(),f("small",$e,h(e.value.user.documentType)+" es requerido o formato inválido",1)):x("",!0)]),a("div",Ye,[Ee,o(y,{id:"name",modelValue:e.value.user.name,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.user.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.name})},null,8,["modelValue","class"]),i.value&&!e.value.name?(_(),f("small",je,"Nombre es requerido.")):x("",!0)]),a("div",ze,[Ge,o(y,{id:"name",modelValue:e.value.user.surnames,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.user.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.surnames})},null,8,["modelValue","class"]),i.value&&!e.value.user.surnames?(_(),f("small",Oe,"Apellido es requerido.")):x("",!0)]),a("div",Ke,[a("div",Ze,[He,o(ae,{showIcon:!0,showButtonBar:!0,modelValue:e.value.user.birthDate,"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.user.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),i.value&&!e.value.birthDate?(_(),f("small",Je,"Fecha de nacimiento es requerido.")):x("",!0)]),a("div",Qe,[We,o(y,{id:"phone",modelValue:e.value.user.phone,"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.user.phone=l),modelModifiers:{trim:!0},class:U({"p-invalid":i.value&&!e.value.user.phone||!A(e.value.user.phone)})},null,8,["modelValue","class"]),i.value&&!e.value.user.phone||!A(e.value.user.phone)?(_(),f("small",Xe," Teléfono es requerido o formato inválido")):x("",!0)])]),a("div",es,[a("div",ss,[ls,o(L,{id:"sex",modelValue:e.value.user.sex,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.user.sex=l),options:Y.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),a("div",as,[os,o(L,{id:"role",modelValue:e.value.roleId,"onUpdate:modelValue":s[12]||(s[12]=l=>e.value.roleId=l),options:E.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),o(R,{visible:V.value,"onUpdate:visible":s[15]||(s[15]=l=>V.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[o(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[14]||(s[14]=l=>V.value=!1)}),o(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:u(()=>[a("div",ts,[ns,e.value?(_(),f("span",us,[g("¿Estás seguro de que quieres eliminar "),a("b",null,h(e.value.user.name),1),g("?")])):x("",!0)])]),_:1},8,["visible"]),o(R,{visible:D.value,"onUpdate:visible":s[17]||(s[17]=l=>D.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[o(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[16]||(s[16]=l=>D.value=!1)}),o(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:se})]),default:u(()=>[a("div",is,[ds,e.value?(_(),f("span",rs,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):x("",!0)])]),_:1},8,["visible"])])])])}}},fs=te(cs,[["__scopeId","data-v-e3148803"]]);export{fs as default};
