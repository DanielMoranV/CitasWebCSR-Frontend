import{_ as ne,u as ue,j as ie,r as d,w as re,q as de,o as ce,s as me,a as c,b as f,d as _,e as a,l as o,v as u,m as w,t as h,n as U,h as I,y as ve,z as pe}from"./index-4af1a839.js";import{u as fe}from"./dataUser-fe915d66.js";import{d as F,a as _e}from"./day-a01efc22.js";const n=N=>(ve("data-v-6721828f"),N=N(),pe(),N),he={class:"grid"},be={class:"col-12"},ye={class:"card"},Ie={class:"my-2"},ge={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},De=n(()=>a("h5",{class:"m-0"},"Gestión de usuarios",-1)),we={class:"block mt-2 md:mt-0 p-input-icon-left"},xe=n(()=>a("i",{class:"pi pi-search"},null,-1)),Ve=n(()=>a("span",{class:"p-column-title"},"DNI",-1)),Ce=n(()=>a("span",{class:"p-column-title"},"Nombre",-1)),Ue=n(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),Ne=n(()=>a("span",{class:"p-column-title"},"Rol",-1)),ke=n(()=>a("span",{class:"p-column-title"},"Status",-1)),Se={class:"field"},Te=n(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),Me={class:"formgrid grid"},Ae={class:"field-radiobutton col-4"},Pe=n(()=>a("label",{for:"dni"},"DNI",-1)),qe={class:"field-radiobutton col-4"},Be=n(()=>a("label",{for:"ce"},"CE",-1)),Fe={class:"field-radiobutton col-4"},Ye=n(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Ee={class:"field"},$e={for:"dni"},Le={key:0,class:"p-invalid"},ze={class:"field"},Re=n(()=>a("label",{for:"name"},"Nombre",-1)),je={key:0,class:"p-invalid"},Ge={class:"field"},Oe=n(()=>a("label",{for:"name"},"Apellidos",-1)),Ke={key:0,class:"p-invalid"},Ze={class:"formgrid grid"},He={class:"field col"},Je=n(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),Qe={key:0,class:"p-invalid"},We={class:"field col"},Xe=n(()=>a("label",{for:"phone"},"Teléfono",-1)),es={key:0,class:"p-invalid"},ss={class:"formgrid grid"},ls={class:"field col"},as=n(()=>a("label",{for:"sex"},"Sexo",-1)),ts={class:"field col"},os=n(()=>a("label",{for:"role"},"Rol",-1)),ns={class:"flex align-items-center justify-content-center"},us=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),is={key:0},rs={class:"flex align-items-center justify-content-center"},ds=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),cs={key:0},ms={__name:"Users",setup(N){const p=ue(),g=fe(),Y=ie(),m=d(null),e=d({user:{dni:null}}),D=d(!1),x=d(!1),V=d(!1),b=d(null),T=d(null),k=d({}),i=d(!1),E=d([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),$=d([{name:"Administrador",code:1},{name:"Admisionista",code:2}]);re([()=>e.value.user.dni],async([t])=>{S(t)&&e.value.user.documentType==="DNI"&&L(t)});const L=async t=>{const s=await Y.searchbydni(t);s?(e.value.user.name=(s==null?void 0:s.nombres)||"",e.value.user.surnames=(s==null?void 0:s.apellidop)+" "+(s==null?void 0:s.apellidom),p.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.user.dni="",e.value.user.name="",e.value.user.surnames="",p.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},M=d({1:"Administrador",2:"Admisionista"}),A=t=>/^[0-9]{9}$/.test(t),S=t=>e.value.user.documentType==="DNI"?/^\d{8}$/.test(t):e.value.user.documentType==="CE"?/^\d{9}$/.test(t):e.value.user.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(t):!0;de(()=>{se()});const z=`listacolaboradores-${F(new Date,"DD-MM-YYYY")}`;ce(async()=>{await g.getCollaborators().then(t=>{m.value=t.map(s=>{let v=F(s.user.birthDate,"DD MMMM YYYY");return s.user.birthDate=v,s.roleName=M.value[s.roleId],s})})});const R=()=>{e.value={accessId:null,active:null,createAt:null,lastSession:null,password:null,roleId:null,roleName:null,status:null,user:{address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null}},i.value=!1,D.value=!0},j=()=>{D.value=!1,i.value=!1},G=()=>{const t=e.value.user;return t.name&&t.name.trim()&&t.surnames&&t.dni&&t.birthDate&&t.sex&&S(t.dni)&&A(t.phone)},O=async()=>{const t={address:e.value.user.address,birthDate:_e(new Date(e.value.user.birthDate)),civilStatus:e.value.user.civilStatus,dni:e.value.user.dni,documentType:e.value.user.documentType,email:e.value.user.email,name:e.value.user.name,phone:e.value.user.phone,photo:e.value.user.photo,sex:e.value.user.sex,surnames:e.value.user.surnames,access:{username:`${e.value.user.dni}-${e.value.roleId}`,password:e.value.user.dni,roleId:e.value.roleId}};if(e.value.accessId){const s=m.value.findIndex(v=>v.accessId===e.value.accessId);s!==-1&&(t.access.accessId=e.value.accessId,t.userId=e.value.user.userId,await g.updateUser(t.dni,t.access.accessId,t),e.value.roleName=M.value[e.value.roleId],m.value[s]=e.value,p.add({severity:"success",summary:"Éxito",detail:"Colaborador Actualizado",life:3e3}))}else{const s=await g.addUsers(t);let v=4;await g.createAccessUser(t.dni,{roleId:v}),e.value.accessId=s.access[0].accessId,e.value.roleName=M.value[e.value.roleId],e.value.status="offline",m.value.push(e.value),p.add({severity:"success",summary:"Éxito",detail:"Colaborador Registrado",life:3e3})}D.value=!1,e.value={user:{dni:null}},i.value=!1},K=t=>{const s=new Date,v=new Date(t);return s.getFullYear()-v.getFullYear()<18?(p.add({severity:"error",summary:"Error",detail:"Debes ser mayor de edad para registrarte.",life:3e3}),!1):!0},Z=async()=>{i.value=!0,K(e.value.user.birthDate)&&(G()?O():p.add({severity:"error",summary:"Error",detail:"Ingresar todos los datos correctamente",life:3e3}))},H=t=>{e.value={...t},D.value=!0},J=t=>{e.value=t,x.value=!0},Q=async()=>{m.value=m.value.filter(t=>t.accessId!==e.value.accessId),await g.disableUser(e.value.accessId),x.value=!1,e.value={user:{dni:null}},p.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},W=()=>{console.log(T.value),T.value.exportCSV()},X=()=>{V.value=!0},ee=()=>{m.value=m.value.filter(s=>!b.value.includes(s)),b.value.map(s=>s.accessId).forEach(async s=>{await g.disableUser(s)}),V.value=!1,b.value=null,p.add({severity:"success",summary:"Successful",detail:"Colaboradores deshabilitados",life:3e3})},se=()=>{k.value={global:{value:null,matchMode:me.CONTAINS}}};return(t,s)=>{const v=c("Toast"),r=c("Button"),le=c("Toolbar"),C=c("InputText"),y=c("Column"),ae=c("DataTable"),P=c("RadioButton"),te=c("Calendar"),B=c("Dropdown"),q=c("Dialog");return f(),_("div",he,[a("div",be,[a("div",ye,[o(v),o(le,{class:"mb-4"},{start:u(()=>[a("div",Ie,[o(r,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:R}),o(r,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:X,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:u(()=>[o(r,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:s[0]||(s[0]=l=>W(l))})]),_:1}),o(ae,{ref_key:"dt",ref:T,value:m.value,selection:b.value,"onUpdate:selection":s[2]||(s[2]=l=>b.value=l),dataKey:"accessId",paginator:!0,rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Colaboradores",responsiveLayout:"scroll",exportFilename:z},{header:u(()=>[a("div",ge,[De,a("span",we,[xe,o(C,{modelValue:k.value.global.value,"onUpdate:modelValue":s[1]||(s[1]=l=>k.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:u(()=>[o(y,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(y,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ve,w(" "+h(l.data.user.dni),1)]),_:1}),o(y,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ce,w(" "+h(l.data.user.name),1)]),_:1}),o(y,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ue,w(" "+h(l.data.user.surnames),1)]),_:1}),o(y,{field:"roleName",header:"Rol",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ne,w(" "+h(l.data.roleName),1)]),_:1}),o(y,{field:"status",header:"Status",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[ke,a("span",{class:U("user-badge status-"+(l.data.status?l.data.status.toLowerCase():""))},h(l.data.status),3)]),_:1}),o(y,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:u(l=>[o(r,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:oe=>H(l.data)},null,8,["onClick"]),o(r,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:oe=>J(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(q,{visible:D.value,"onUpdate:visible":s[13]||(s[13]=l=>D.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:u(()=>[o(r,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:j}),o(r,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Z})]),default:u(()=>[a("div",Se,[Te,a("div",Me,[a("div",Ae,[o(P,{id:"dni",name:"option",value:"DNI",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Pe]),a("div",qe,[o(P,{id:"ce",name:"option",value:"CE",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Be]),a("div",Fe,[o(P,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Ye])])]),a("div",Ee,[a("label",$e,h(e.value.user.documentType),1),o(C,{id:"dni",modelValue:e.value.user.dni,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.user.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.dni||!S(e.value.user.dni)})},null,8,["modelValue","class"]),i.value&&!e.value.user.dni||!S(e.value.user.dni)?(f(),_("small",Le,h(e.value.user.documentType)+" es requerido o formato inválido",1)):I("",!0)]),a("div",ze,[Re,o(C,{id:"name",modelValue:e.value.user.name,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.user.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.name})},null,8,["modelValue","class"]),i.value&&!e.value.name?(f(),_("small",je,"Nombre es requerido.")):I("",!0)]),a("div",Ge,[Oe,o(C,{id:"name",modelValue:e.value.user.surnames,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.user.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:U({"p-invalid":i.value&&!e.value.user.surnames})},null,8,["modelValue","class"]),i.value&&!e.value.user.surnames?(f(),_("small",Ke,"Apellido es requerido.")):I("",!0)]),a("div",Ze,[a("div",He,[Je,o(te,{showIcon:!0,showButtonBar:!0,modelValue:e.value.user.birthDate,"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.user.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),i.value&&!e.value.birthDate?(f(),_("small",Qe,"Fecha de nacimiento es requerido.")):I("",!0)]),a("div",We,[Xe,o(C,{id:"phone",modelValue:e.value.user.phone,"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.user.phone=l),modelModifiers:{trim:!0},class:U({"p-invalid":i.value&&!e.value.user.phone||!A(e.value.user.phone)})},null,8,["modelValue","class"]),i.value&&!e.value.user.phone||!A(e.value.user.phone)?(f(),_("small",es," Teléfono es requerido o formato inválido")):I("",!0)])]),a("div",ss,[a("div",ls,[as,o(B,{id:"sex",modelValue:e.value.user.sex,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.user.sex=l),options:E.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),a("div",ts,[os,o(B,{id:"role",modelValue:e.value.roleId,"onUpdate:modelValue":s[12]||(s[12]=l=>e.value.roleId=l),options:$.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),o(q,{visible:x.value,"onUpdate:visible":s[15]||(s[15]=l=>x.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[o(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[14]||(s[14]=l=>x.value=!1)}),o(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:u(()=>[a("div",ns,[us,e.value?(f(),_("span",is,[w("¿Estás seguro de que quieres eliminar "),a("b",null,h(e.value.user.name),1),w("?")])):I("",!0)])]),_:1},8,["visible"]),o(q,{visible:V.value,"onUpdate:visible":s[17]||(s[17]=l=>V.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[o(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[16]||(s[16]=l=>V.value=!1)}),o(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ee})]),default:u(()=>[a("div",rs,[ds,e.value?(f(),_("span",cs,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):I("",!0)])]),_:1},8,["visible"])])])])}}},_s=ne(ms,[["__scopeId","data-v-6721828f"]]);export{_s as default};
