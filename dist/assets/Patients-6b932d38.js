import{_ as oe,u as ne,r,m as de,o as ie,p as ue,a as m,b as _,c as f,d as a,e as t,q as d,j as g,t as h,n as k,l as I,v as re,x as ce}from"./index-16712e5a.js";import{u as me}from"./dataUser-d769bb74.js";import{d as $,a as pe}from"./day-a01efc22.js";import{r as ve,u as _e}from"./xlsx-04f2268f.js";const n=U=>(re("data-v-98590188"),U=U(),ce(),U),fe={class:"grid"},he={class:"col-12"},be={class:"card"},ye={class:"my-2"},Ie={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},xe=n(()=>a("h5",{class:"m-0"},"Gestión de usuarios",-1)),ge={class:"block mt-2 md:mt-0 p-input-icon-left"},De=n(()=>a("i",{class:"pi pi-search"},null,-1)),we=n(()=>a("span",{class:"p-column-title"},"DNI",-1)),Ve=n(()=>a("span",{class:"p-column-title"},"Nombre",-1)),ke=n(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),Ue=n(()=>a("span",{class:"p-column-title"},"Rol",-1)),Ce=n(()=>a("span",{class:"p-column-title"},"Status",-1)),Se={class:"field"},Te=n(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),Ne={class:"formgrid grid"},Pe={class:"field-radiobutton col-4"},Me=n(()=>a("label",{for:"dni"},"DNI",-1)),Ae={class:"field-radiobutton col-4"},qe=n(()=>a("label",{for:"ce"},"CE",-1)),Fe={class:"field-radiobutton col-4"},Be=n(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Re={class:"field"},Le={for:"dni"},$e={key:0,class:"p-invalid"},Ye={class:"field"},Ee=n(()=>a("label",{for:"name"},"Nombre",-1)),je={key:0,class:"p-invalid"},ze={class:"field"},Ge=n(()=>a("label",{for:"name"},"Apellidos",-1)),Oe={key:0,class:"p-invalid"},Ke={class:"formgrid grid"},Ze={class:"field col"},He=n(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),Je={key:0,class:"p-invalid"},Qe={class:"field col"},We=n(()=>a("label",{for:"phone"},"Teléfono",-1)),Xe={key:0,class:"p-invalid"},es={class:"formgrid grid"},ss={class:"field col"},ls=n(()=>a("label",{for:"sex"},"Sexo",-1)),as={class:"field col"},ts=n(()=>a("label",{for:"role"},"Rol",-1)),os={class:"flex align-items-center justify-content-center"},ns=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ds={key:0},is={class:"flex align-items-center justify-content-center"},us=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),rs={key:0},cs={__name:"Patients",setup(U){const C=ne(),D=me(),c=r(null),e=r({}),x=r(!1),w=r(!1),V=r(!1),b=r(null),N=r(null),S=r({}),i=r(!1),Y=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),E=r([{name:"Administrador",code:1},{name:"Admisionista",code:2}]),R=r({1:"Administrador",2:"Admisionista"}),P=o=>/^[0-9]{9}$/.test(o),M=o=>e.value.user.documentType==="DNI"?/^\d{8}$/.test(o):e.value.user.documentType==="CE"?/^\d{9}$/.test(o):e.value.user.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(o):!0;de(()=>{le()});const j=`listcolaborator-${$(new Date,"DD-MM-YYYY")}`;ie(async()=>{await D.getPatients().then(o=>{c.value=o.map(s=>{let v=$(s.user.birthDate,"DD MMMM YYYY");return s.user.birthDate=v,s.user.dependents.length&&(console.log("Tengo dependiente"),c.value.push({address:s.user.dependents.address,birthDate:s.user.dependents.birthDate,dependentId:s.user.dependents.dependentId,dni:s.user.dependents.dni,documentType:s.user.dependents.documentType,name:s.user.dependents.name,photo:s.user.dependents.photo,sex:s.user.dependents.sex,surnames:s.user.dependents.surnames,userId:s.user.dependents.userId})),s})}),console.log(c.value)});const z=()=>{e.value={accessId:null,active:null,createAt:null,lastSession:null,password:null,roleId:null,roleName:null,status:null,user:{address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null}},i.value=!1,x.value=!0},G=()=>{x.value=!1,i.value=!1},O=()=>{const o=e.value.user;return o.name&&o.name.trim()&&o.surnames&&o.dni&&o.birthDate&&o.sex&&M(o.dni)&&P(o.phone)},K=async()=>{const o={address:e.value.user.address,birthDate:pe(new Date(e.value.user.birthDate)),civilStatus:e.value.user.civilStatus,dni:e.value.user.dni,documentType:e.value.user.documentType,email:e.value.user.email,name:e.value.user.name,phone:e.value.user.phone,photo:e.value.user.photo,sex:e.value.user.sex,surnames:e.value.user.surnames,access:{username:`${e.value.user.dni}-${e.value.roleId}`,password:e.value.user.dni,roleId:e.value.roleId}};if(e.value.accessId){const s=c.value.findIndex(v=>v.accessId===e.value.accessId);s!==-1&&(o.access.accessId=e.value.accessId,o.userId=e.value.user.userId,await D.updateUser(o.dni,o.access.accessId,o),e.value.roleName=R.value[e.value.roleId],c.value[s]=e.value,C.add({severity:"success",summary:"Éxito",detail:"Colaborador Actualizado",life:3e3}))}else{const s=await D.addUsers(o);e.value.accessId=s.access[0].accessId,e.value.roleName=R.value[e.value.roleId],e.value.status="offline",c.value.push(e.value),C.add({severity:"success",summary:"Éxito",detail:"Colaborador Registrado",life:3e3})}x.value=!1,e.value={},i.value=!1},Z=async()=>{i.value=!0,O()&&K()},H=o=>{e.value={...o},x.value=!0},J=o=>{e.value=o,w.value=!0},Q=async()=>{c.value=c.value.filter(o=>o.accessId!==e.value.accessId),await D.disableUser(e.value.accessId),w.value=!1,e.value={},C.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},W=()=>{console.log(N.value),N.value.exportCSV()},X=o=>{const s=o.files[0],v=new FileReader;v.onload=u=>{const A=new Uint8Array(u.target.result),T=ve(A,{type:"array"}),y=T.SheetNames[0],p=T.Sheets[y],q=_e.sheet_to_json(p);console.log(q)},v.readAsArrayBuffer(s)},ee=()=>{V.value=!0},se=()=>{c.value=c.value.filter(s=>!b.value.includes(s)),b.value.map(s=>s.accessId).forEach(async s=>{await D.disableUser(s)}),V.value=!1,b.value=null,C.add({severity:"success",summary:"Successful",detail:"Pacientes deshabilitados",life:3e3})},le=()=>{S.value={global:{value:null,matchMode:ue.CONTAINS}}};return(o,s)=>{const v=m("Toast"),u=m("Button"),A=m("FileUpload"),T=m("Toolbar"),y=m("InputText"),p=m("Column"),q=m("DataTable"),F=m("RadioButton"),ae=m("Calendar"),L=m("Dropdown"),B=m("Dialog");return _(),f("div",fe,[a("div",he,[a("div",be,[t(v),t(T,{class:"mb-4"},{start:d(()=>[a("div",ye,[t(u,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:z}),t(u,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:ee,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:d(()=>[t(A,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:X}),t(u,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:s[0]||(s[0]=l=>W(l))})]),_:1}),t(q,{ref_key:"dt",ref:N,value:c.value,selection:b.value,"onUpdate:selection":s[2]||(s[2]=l=>b.value=l),dataKey:"accessId",paginator:!0,rows:10,filters:S.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Pacientes",responsiveLayout:"scroll",exportFilename:j},{header:d(()=>[a("div",Ie,[xe,a("span",ge,[De,t(y,{modelValue:S.value.global.value,"onUpdate:modelValue":s[1]||(s[1]=l=>S.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[t(p,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(p,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[we,g(" "+h(l.data.user.dni),1)]),_:1}),t(p,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ve,g(" "+h(l.data.user.name),1)]),_:1}),t(p,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[ke,g(" "+h(l.data.user.surnames),1)]),_:1}),t(p,{field:"roleName",header:"Rol",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ue,g(" "+h(l.data.roleName),1)]),_:1}),t(p,{field:"status",header:"Status",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ce,a("span",{class:k("user-badge status-"+(l.data.status?l.data.status.toLowerCase():""))},h(l.data.status),3)]),_:1}),t(p,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:d(l=>[t(u,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:te=>H(l.data)},null,8,["onClick"]),t(u,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:te=>J(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),t(B,{visible:x.value,"onUpdate:visible":s[13]||(s[13]=l=>x.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:d(()=>[t(u,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:G}),t(u,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Z})]),default:d(()=>[a("div",Se,[Te,a("div",Ne,[a("div",Pe,[t(F,{id:"dni",name:"option",value:"DNI",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Me]),a("div",Ae,[t(F,{id:"ce",name:"option",value:"CE",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),qe]),a("div",Fe,[t(F,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Be])])]),a("div",Re,[a("label",Le,h(e.value.user.documentType),1),t(y,{id:"name",modelValue:e.value.user.dni,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.user.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.dni||!M(e.value.user.dni)})},null,8,["modelValue","class"]),i.value&&!e.value.user.dni||!M(e.value.user.dni)?(_(),f("small",$e,h(e.value.user.documentType)+" es requerido o formato inválido",1)):I("",!0)]),a("div",Ye,[Ee,t(y,{id:"name",modelValue:e.value.user.name,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.user.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.name})},null,8,["modelValue","class"]),i.value&&!e.value.name?(_(),f("small",je,"Nombre es requerido.")):I("",!0)]),a("div",ze,[Ge,t(y,{id:"name",modelValue:e.value.user.surnames,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.user.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.surnames})},null,8,["modelValue","class"]),i.value&&!e.value.user.surnames?(_(),f("small",Oe,"Apellido es requerido.")):I("",!0)]),a("div",Ke,[a("div",Ze,[He,t(ae,{showIcon:!0,showButtonBar:!0,modelValue:e.value.user.birthDate,"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.user.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),i.value&&!e.value.birthDate?(_(),f("small",Je,"Fecha de nacimiento es requerido.")):I("",!0)]),a("div",Qe,[We,t(y,{id:"phone",modelValue:e.value.user.phone,"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.user.phone=l),modelModifiers:{trim:!0},class:k({"p-invalid":i.value&&!e.value.user.phone||!P(e.value.user.phone)})},null,8,["modelValue","class"]),i.value&&!e.value.user.phone||!P(e.value.user.phone)?(_(),f("small",Xe," Teléfono es requerido o formato inválido")):I("",!0)])]),a("div",es,[a("div",ss,[ls,t(L,{id:"sex",modelValue:e.value.user.sex,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.user.sex=l),options:Y.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),a("div",as,[ts,t(L,{id:"role",modelValue:e.value.roleId,"onUpdate:modelValue":s[12]||(s[12]=l=>e.value.roleId=l),options:E.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),t(B,{visible:w.value,"onUpdate:visible":s[15]||(s[15]=l=>w.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[t(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[14]||(s[14]=l=>w.value=!1)}),t(u,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:d(()=>[a("div",os,[ns,e.value?(_(),f("span",ds,[g("¿Estás seguro de que quieres eliminar "),a("b",null,h(e.value.user.name),1),g("?")])):I("",!0)])]),_:1},8,["visible"]),t(B,{visible:V.value,"onUpdate:visible":s[17]||(s[17]=l=>V.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[t(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[16]||(s[16]=l=>V.value=!1)}),t(u,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:se})]),default:d(()=>[a("div",is,[us,e.value?(_(),f("span",rs,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):I("",!0)])]),_:1},8,["visible"])])])])}}},fs=oe(cs,[["__scopeId","data-v-98590188"]]);export{fs as default};
