import{_ as ue,k as re,u as ce,h as pe,y as me,r as d,m as ve,w as he,o as _e,p as P,C as ye,a as v,b as A,c as $,d as o,e as n,q as i,j as h,t as c,n as fe,A as B,D as R,l as x,v as be,x as ge}from"./index-d5318078.js";import{u as we}from"./dataAppointment-4931375c.js";import{u as Ie}from"./dataUser-308a5b9c.js";import{d as N}from"./day-a01efc22.js";const m=D=>(be("data-v-abd90dad"),D=D(),ge(),D),Ce={class:"grid"},De={class:"col-12"},Se={class:"card"},Me={class:"my-2"},Ae={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Te=m(()=>o("h5",{class:"m-0"},"Citas Médicas",-1)),ke={class:"block mt-2 md:mt-0 p-input-icon-left"},Ve=m(()=>o("i",{class:"pi pi-search"},null,-1)),Pe=m(()=>o("span",{class:"p-column-title"},"Nº Turno",-1)),xe=m(()=>o("span",{class:"p-column-title"},"Paciente",-1)),Ne=m(()=>o("span",{class:"p-column-title"},"Estado",-1)),Ee=m(()=>o("span",{class:"p-column-title"},"Médico",-1)),Le={class:"p-multiselect-representative-option"},Fe={style:{"margin-left":"0.5em","vertical-align":"middle"},class:"image-text"},ze=m(()=>o("span",{class:"p-column-title"},"Especialidad",-1)),Ye=m(()=>o("span",{class:"p-column-title"},"Origen",-1)),qe=m(()=>o("span",{class:"p-column-title"},"Fecha Consulta",-1)),Ue={class:"flex align-items-center justify-content-center"},$e=m(()=>o("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Be={key:0},Re={class:"mb-1"},Oe={class:"mb-1"},je={class:"mb-1"},Ke={class:"mb-1"},He={class:"field col-12 md:col-12 mt-12 mt-4"},We={class:"p-float-label"},Ge=m(()=>o("label",{for:"autocomplete"},"Paciente",-1)),Je={__name:"Shifts",setup(D){const O=re(),T=ce();pe();const j=Ie(),K=me(),_=we(),E=d([]),g=d([]),l=d(null),L=d(null),w=d({}),S=d(null),M=d(!1),I=d(!1),F=d(!0),z=d(null),k=d(null),p=d(null),Y=d([]),C=d(!0),y=d({amount:null,paymentDate:null,appointmentId:null,paymentMethodId:null,VoucherTypeId:null,userId:null}),r=d(null);ve(()=>J());const H=()=>L.value.exportCSV(),W=()=>O.push("/listdoctor"),G=e=>{const a=e.query.toLowerCase();Y.value=a.trim().length?k.value.filter(s=>s.fullName.toLowerCase().includes(a)):[...k.value]};he(p,e=>{console.log(e),e!=null&&(C.value=!1)}),_e(async()=>{const e=document.createElement("script");e.src="https://checkout.culqi.com/js/v4",e.async=!0,e.onload=()=>{Culqi.publicKey="pk_test_73e0f77c30643c37",C.value=!1},document.body.appendChild(e),await K.getDoctors().then(a=>{E.value=a.map(s=>(s.name=`${s.user.surnames} ${s.user.name}`,s))}),g.value=await _.getAppointment(),V(),S.value=!1,z.value=await j.getPatients(),k.value=ae(z.value),F.value=!1});const J=()=>{w.value={global:{value:null,matchMode:P.CONTAINS},nameDoctor:{value:null,matchMode:P.IN},orderlyTurn:{operator:ye.AND,constraints:[{value:null,matchMode:P.DATE_IS}]}}},Q=e=>{l.value=e,console.log(l.value),I.value=!0},X=async()=>{await _.deleteAppointmentId(l.value.Appointment[0].appointmentId),I.value=!1,l.value={},T.add({severity:"success",summary:"Éxito",detail:"Cita médica eliminada",life:3e3})},Z=e=>{l.value=e,console.log(l.value),M.value=!0,C.value=!0,p.value=null},ee=async()=>{const e=q();await _.addappointment(e),g.value=await _.getAppointment(),V(),y.value={amount:l.value.price,paymentDate:new Date,appointmentId:_.appointment.appointmentId,paymentMethodId:2,VoucherTypeId:5,userId:p.value.userId},Culqi.settings({title:"CSR Consultas Web",currency:"PEN",amount:y.value.amount*100}),Culqi.open()},te=async()=>{const e=q();await _.addappointment(e),g.value=await _.getAppointment(),V()};window.addEventListener("culqiTokenCreated",async e=>{r.value=e.detail,r.value.metadata.appointmentId=y.value.appointmentId,r.value.metadata.paymentMethodId=y.value.paymentMethodId,r.value.metadata.VoucherTypeId=y.value.VoucherTypeId,r.value.metadata.paymentDate=y.value.paymentDate,r.value.metadata.userId=y.value.userId,r.value.metadata.amount=y.value.amount*100,r.value.client.address=p.value.address,r.value.client.phone=p.value.phone,r.value.client.name=p.value.name,r.value.client.surnames=p.value.surnames,r.value.dataPayment={nameDoctor:l.value.nameDoctor,specialty:l.value.specialization,patient:p.value.fullName,date:N(l.value.orderlyTurn,"DD MMMM YYYY hh:mm A"),price:l.value.price};const a=await _.addPayment(r.value);a.message?(T.add({severity:"error",summary:"Error",detail:a.message,life:4e3}),await _.deleteAppointmentId(l.value.Appointment[0].appointmentId)):T.add({severity:"success",summary:"Éxito",detail:"Pago realizado correctamente",life:4e3}),Culqi.close(),M.value=!1});function V(){g.value.forEach(e=>{e.orderlyTurn=new Date(e.orderlyTurn),e.specialization=e.Schedule.doctor.specialization,e.nameDoctor=`${e.Schedule.doctor.user.surnames} ${e.Schedule.doctor.user.name}`,e.price=e.Schedule.doctor.personalizedPrices[0].personalizedPrice,e.Appointment[0]&&(e.status=e.Appointment[0].status,e.origin=e.Appointment[0].origin,e.Appointment[0].dependent?e.patient=`${e.Appointment[0].dependent.name} ${e.Appointment[0].dependent.surnames}`:e.patient=`${e.Appointment[0].user.name} ${e.Appointment[0].user.surnames}`)})}function ae(e){const a=[];return e.forEach(s=>{a.push({userId:s.user.userId,fullName:s.user.name+" "+s.user.surnames+" "+s.user.dni,dependents:s.user.dependents,name:s.user.name,surnames:s.user.surnames,address:s.user.address,phone:s.user.phone}),s.user.dependents.length&&s.user.dependents.forEach(u=>{a.push({userId:u.userId,fullName:u.name+" "+u.surnames+" "+u.dni,dependentId:u.dependentId,name:s.user.name,surnames:s.user.surnames,address:s.user.address,phone:s.user.phone})})}),a}function q(){return{origin:"admisión",status:"pendiente",createAt:new Date,doctorId:l.value.Schedule.doctor.doctorId,userId:p.value.userId,dependentId:p.value.dependentId,timeSlotId:l.value.timeSlotId,appointmentServices:{create:[{medicalServiceId:1}]}}}return(e,a)=>{const s=v("Toast"),u=v("Button"),oe=v("Toolbar"),le=v("InputText"),f=v("Column"),se=v("MultiSelect"),ne=v("Calendar"),ie=v("DataTable"),U=v("Dialog"),de=v("AutoComplete");return A(),$("div",Ce,[o("div",De,[o("div",Se,[n(s),n(oe,{class:"mb-4"},{start:i(()=>[o("div",Me,[n(u,{label:"Agendar Cita Médica",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:W})])]),end:i(()=>[n(u,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:a[0]||(a[0]=t=>H(t))})]),_:1}),n(ie,{ref_key:"dt",ref:L,value:g.value,dataKey:"timeSlotId",paginator:!0,rows:10,rowHover:!0,filters:w.value,"onUpdate:filters":a[2]||(a[2]=t=>w.value=t),filterDisplay:"menu",loading:S.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando del  {first} al {last} de {totalRecords} Atenciones",globalFilterFields:["nTurn","patient","status","nameDoctor","status","specialization","orderlyTurn","origin"],responsiveLayout:"scroll"},{header:i(()=>[o("div",Ae,[Te,o("span",ke,[Ve,n(le,{modelValue:w.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=t=>w.value.global.value=t),placeholder:"Buscar..."},null,8,["modelValue"])])])]),empty:i(()=>[h("No se encontraron citas médicas ")]),loading:i(()=>[h(" Cargando datos. Espere por favor. ")]),default:i(()=>[n(f,{field:"nTurn",header:"Nº Turno",sortable:!0,headerStyle:"width:10%; min-width:2rem;"},{body:i(t=>[Pe,h(" "+c(t.data.nTurn),1)]),_:1}),n(f,{field:"patient",header:"Paciente",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(t=>[xe,h(" "+c(t.data.patient),1)]),_:1}),n(f,{field:"status",header:"Estado",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(t=>[Ne,o("span",{class:fe("user-badge status-"+(t.data.status?t.data.status.toLowerCase():""))},c(t.data.status||"Disponible"),3)]),_:1}),n(f,{field:"nameDoctor",header:"Médico",sortable:!0,showFilterMatchModes:!1,headerStyle:"width:14%; min-width:10rem;"},{body:i(t=>[Ee,h(" "+c(t.data.nameDoctor),1)]),filter:i(({filterModel:t})=>[n(se,{modelValue:t.value,"onUpdate:modelValue":b=>t.value=b,options:E.value,optionLabel:"name",optionValue:"name",placeholder:"Buscar Por Médico",class:"p-column-filter"},{option:i(b=>[o("div",Le,[o("span",Fe,c(b.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),n(f,{field:"specialization",header:"Especialidad",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(t=>[ze,h(" "+c(t.data.specialization),1)]),_:1}),n(f,{field:"origin",header:"Origen",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(t=>[Ye,h(" "+c(t.data.origin),1)]),_:1}),n(f,{field:"orderlyTurn",header:"Fecha Consulta",showFilterMatchModes:!1,sortable:!0,headerStyle:"width:15%; min-width:10rem;"},{body:i(t=>[qe,h(" "+c(B(N)(t.data.orderlyTurn,"DD MMMM YYYY hh:mm a")),1)]),filter:i(({filterModel:t})=>[n(ne,{modelValue:t.value,"onUpdate:modelValue":b=>t.value=b,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(f,{headerStyle:"width:10%; min-width:5rem;",header:"Acciones"},{body:i(t=>[t.data.status?(A(),R(u,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2 mr-2",onClick:b=>Q(t.data)},null,8,["onClick"])):x("",!0),t.data.status?x("",!0):(A(),R(u,{key:1,icon:"pi pi-calendar-plus",class:"p-button-rounded p-button-success mt-2",onClick:b=>Z(t.data)},null,8,["onClick"]))]),_:1})]),_:1},8,["value","filters","loading"]),n(U,{visible:I.value,"onUpdate:visible":a[4]||(a[4]=t=>I.value=t),style:{width:"450px"},header:"Eliminar Cita",modal:!0},{footer:i(()=>[n(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[3]||(a[3]=t=>I.value=!1)}),n(u,{label:"Si",icon:"pi pi-check",class:"p-button-text",onClick:X})]),default:i(()=>[o("div",Ue,[$e,l.value?(A(),$("span",Be,[h("Estás seguro de que quieres eliminar atención Nº "),o("b",null,c(l.value.Appointment[0].appointmentId),1),h("?")])):x("",!0)])]),_:1},8,["visible"]),n(U,{visible:M.value,"onUpdate:visible":a[7]||(a[7]=t=>M.value=t),style:{width:"450px"},header:"Agendar Consulta Médica",modal:!0,class:"grid p-fluid"},{default:i(()=>[o("p",Re,"Medico : "+c(l.value?l.value.nameDoctor:"No disponible"),1),o("p",Oe,"Especialidad : "+c(l.value?l.value.specialization:"No disponible"),1),o("p",je,"Fecha: "+c(l.value?B(N)(l.value.orderlyTurn,"DD MMMM YYYY hh:mm A"):"No disponible"),1),o("p",Ke,"Total : S/ "+c(l.value?l.value.price:"No disponible"),1),o("div",He,[o("span",We,[n(de,{id:"patients",dropdown:!0,modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=t=>p.value=t),suggestions:Y.value,onComplete:a[6]||(a[6]=t=>G(t)),field:"fullName",disabled:F.value},null,8,["modelValue","suggestions","disabled"]),Ge])]),n(u,{label:"Método de pago Efectivo",icon:"pi pi-money-bill",class:"p-button-default col-12 mb-2",disabled:C.value,loading:S.value,onClick:te},null,8,["disabled","loading"]),n(u,{label:"Método de pago Digital",icon:"pi pi-credit-card",class:"p-button-success col-12",disabled:C.value,loading:S.value,onClick:ee},null,8,["disabled","loading"])]),_:1},8,["visible"])])])])}}},tt=ue(Je,[["__scopeId","data-v-abd90dad"]]);export{tt as default};
