import{_ as de,u as ue,h as re,r as c,w as ce,m as me,o as ve,p as pe,a as m,b as f,c as h,d as t,e as o,q as d,j as D,t as _,n as P,l as I,v as fe,x as he,s as _e}from"./index-a19affa2.js";import{u as be}from"./dataUser-b752686d.js";import{d as U,a as ye}from"./day-a01efc22.js";import{r as De,u as Ie}from"./xlsx-04f2268f.js";const n=C=>(fe("data-v-37e9f4e2"),C=C(),he(),C),ge={class:"grid"},xe={class:"col-12"},Ve={class:"card"},we={class:"my-2"},Se={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ke=n(()=>t("h5",{class:"m-0"},"Gestión de usuarios",-1)),Ue={class:"block mt-2 md:mt-0 p-input-icon-left"},Ce=n(()=>t("i",{class:"pi pi-search"},null,-1)),Te=n(()=>t("span",{class:"p-column-title"},"DNI",-1)),Ne=n(()=>t("span",{class:"p-column-title"},"Apellidos",-1)),Me=n(()=>t("span",{class:"p-column-title"},"Nombre",-1)),Pe=n(()=>t("span",{class:"p-column-title"},"Fecha Nacimiento",-1)),Ye=n(()=>t("span",{class:"p-column-title"},"Teléfono",-1)),Fe={class:"field"},qe=n(()=>t("label",{class:"mb-3"},"Tipo de documento",-1)),Ae={class:"formgrid grid"},Be={class:"field-radiobutton col-4"},Ee=n(()=>t("label",{for:"dni"},"DNI",-1)),Le={class:"field-radiobutton col-4"},$e=n(()=>t("label",{for:"ce"},"CE",-1)),je={class:"field-radiobutton col-4"},ze=n(()=>t("label",{for:"pasaport"},"Pasaporte",-1)),Re={class:"field"},Ge={for:"dni"},Oe={key:0,class:"p-invalid"},Ke={class:"field"},Ze=n(()=>t("label",{for:"name"},"Nombre",-1)),He={key:0,class:"p-invalid"},Je={class:"field"},Qe=n(()=>t("label",{for:"name"},"Apellidos",-1)),We={key:0,class:"p-invalid"},Xe={class:"formgrid grid"},ea={class:"field col"},aa=n(()=>t("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),la={key:0,class:"p-invalid"},sa={class:"field col"},ta=n(()=>t("label",{for:"phone"},"Teléfono",-1)),oa={key:0,class:"p-invalid"},na={class:"formgrid grid"},ia={class:"field col"},da=n(()=>t("label",{for:"sex"},"Sexo",-1)),ua={class:"field col"},ra=n(()=>t("label",{for:"role"},"Estado Civil",-1)),ca={class:"flex align-items-center justify-content-center"},ma=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),va={key:0},pa={class:"flex align-items-center justify-content-center"},fa=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ha={key:0},_a={__name:"Patients",setup(C){const g=ue(),j=re(),V=be(),L=c(null),w=c(!0),u=c([]),e=c({}),x=c(!1),S=c(!1),k=c(!1),b=c(null),Y=c(null),T=c({}),r=c(!1),z=c([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),R=c([{name:"Soltero",code:"Soltero"},{name:"Casado",code:"Casado"},{name:"Viudo",code:"Viudo"},{name:"Divorciado",code:"Divorciado"}]);ce([()=>e.value.dni],async([s])=>{N(s)&&e.value.documentType==="DNI"&&G(s)});const G=async s=>{const a=await j.searchbydni(s);a?(e.value.name=(a==null?void 0:a.nombres)||"",e.value.surnames=(a==null?void 0:a.apellidop)+" "+(a==null?void 0:a.apellidom),g.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.dni="",e.value.name="",e.value.surnames="",g.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},F=s=>/^[0-9]{9}$/.test(s),N=s=>e.value.documentType==="DNI"?(w.value=!0,/^\d{8}$/.test(s)):e.value.documentType==="CE"?(w.value=!1,/^\d{9}$/.test(s)):e.value.documentType==="Pasaporte"?(w.value=!1,/^[A-Za-z0-9]{5,20}$/.test(s)):!0;me(()=>{oe()});const O=`listpatients-${U(new Date,"DD-MM-YYYY")}`;ve(async()=>{await V.getPatients().then(s=>{L.value=s.flatMap(a=>[{accessId:a.accessId,user:a.user},...(a.user.dependents||[]).map(i=>({accessId:i.accessId,user:i}))])}),L.value.forEach(s=>{const a=s.user;let v=U(a.birthDate,"DD MMMM YYYY");a.birthDate=v,a.accessId=s.accessId,u.value.push(a)}),console.log(u.value)});const K=()=>{e.value={accessId:null,address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null},r.value=!1,x.value=!0},Z=()=>{x.value=!1,r.value=!1},H=()=>{const s=e.value;return s.name&&s.name.trim()&&s.surnames&&s.dni&&s.birthDate&&s.sex&&N(s.dni)&&F(s.phone)},J=async()=>{console.log(e.value);const s={address:e.value.address,birthDate:ye(e.value.birthDate),civilStatus:e.value.civilStatus,dni:e.value.dni,documentType:e.value.documentType,email:e.value.email,name:e.value.name,phone:e.value.phone,photo:e.value.photo,sex:e.value.sex,surnames:e.value.surnames,access:{username:`${e.value.dni}`,password:e.value.dni,roleId:4}};if(e.value.accessId||e.value.dependentId){const a=u.value.findIndex(v=>v.accessId===e.value.accessId);if(a!==-1){if(e.value.accessId&&(s.access.accessId=e.value.accessId,s.userId=e.value.userId,await V.updatePatient(s.dni,s.access.accessId,s)),e.value.dependentId){s.dependentId=e.value.dependentId;const{access:v,...i}=s;await _e(e.value.dependentId,i)}e.value.birthDate=U(e.value.birthDate,"DD MMMM YYYY"),u.value[a]=e.value,g.add({severity:"success",summary:"Éxito",detail:"Paciente Actualizado",life:3e3})}}else{const a=await V.addUsers(s);console.log(a),console.log(u.value),e.value.accessId=a.access[0].accessId,e.value.status="offline",e.value.birthDate=U(e.value.birthDate,"DD MMMM YYYY"),u.value.push(e.value),g.add({severity:"success",summary:"Éxito",detail:"Paciente Registrado",life:3e3})}x.value=!1,e.value={},r.value=!1},Q=async()=>{r.value=!0,console.log(e.value),H()&&(console.log(e.value),J(),console.log(e.value))},W=s=>{e.value={...s},e.value.birthDate=new Date(e.value.birthDate),console.log(e.value),console.log("editar paciente",U(e.value.birthDate,"DD/MM/YYYY")),x.value=!0},X=s=>{e.value=s,S.value=!0},ee=async()=>{console.log(e.value),e.value.accessId==null?(u.value=u.value.filter(s=>s.dni!==e.value.dni),await V.deleteUserDependents(e.value.dependentId)):(u.value=u.value.filter(s=>s.accessId!==e.value.accessId),await V.disableUser(e.value.accessId)),console.log(e.value),S.value=!1,e.value={},g.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},ae=()=>{console.log(Y.value),Y.value.exportCSV()},le=s=>{const a=s.files[0],v=new FileReader;v.onload=i=>{const q=new Uint8Array(i.target.result),M=De(q,{type:"array"}),y=M.SheetNames[0],p=M.Sheets[y],A=Ie.sheet_to_json(p);console.log(A)},v.readAsArrayBuffer(a)},se=()=>{k.value=!0},te=()=>{u.value=u.value.filter(a=>!b.value.includes(a)),b.value.map(a=>a.dni).forEach(async a=>{console.log(a)}),k.value=!1,b.value=null,g.add({severity:"success",summary:"Successful",detail:"Pacientes deshabilitados",life:3e3})},oe=()=>{T.value={global:{value:null,matchMode:pe.CONTAINS}}};return(s,a)=>{const v=m("Toast"),i=m("Button"),q=m("FileUpload"),M=m("Toolbar"),y=m("InputText"),p=m("Column"),A=m("DataTable"),B=m("RadioButton"),ne=m("Calendar"),$=m("Dropdown"),E=m("Dialog");return f(),h("div",ge,[t("div",xe,[t("div",Ve,[o(v),o(M,{class:"mb-4"},{start:d(()=>[t("div",we,[o(i,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:K}),o(i,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:se,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:d(()=>[o(q,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:le}),o(i,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:a[0]||(a[0]=l=>ae(l))})]),_:1}),o(A,{ref_key:"dt",ref:Y,value:u.value,selection:b.value,"onUpdate:selection":a[2]||(a[2]=l=>b.value=l),dataKey:"dni",paginator:!0,rows:10,filters:T.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Pacientes",responsiveLayout:"scroll",exportFilename:O},{header:d(()=>[t("div",Se,[ke,t("span",Ue,[Ce,o(y,{modelValue:T.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=l=>T.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[o(p,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(p,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Te,D(" "+_(l.data.dni),1)]),_:1}),o(p,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:d(l=>[Ne,D(" "+_(l.data.surnames),1)]),_:1}),o(p,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Me,D(" "+_(l.data.name),1)]),_:1}),o(p,{field:"roleName",header:"Fecha de Nacimiento",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Pe,D(" "+_(l.data.birthDate),1)]),_:1}),o(p,{field:"status",header:"Teléfono",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ye,D(" "+_(l.data.phone),1)]),_:1}),o(p,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:d(l=>[o(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:ie=>W(l.data)},null,8,["onClick"]),o(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:ie=>X(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(E,{visible:x.value,"onUpdate:visible":a[13]||(a[13]=l=>x.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:d(()=>[o(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:Z}),o(i,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:d(()=>[t("div",Fe,[qe,t("div",Ae,[t("div",Be,[o(B,{id:"dni",name:"option",value:"DNI",modelValue:e.value.documentType,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ee]),t("div",Le,[o(B,{id:"ce",name:"option",value:"CE",modelValue:e.value.documentType,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.documentType=l)},null,8,["modelValue"]),$e]),t("div",je,[o(B,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.documentType,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.documentType=l)},null,8,["modelValue"]),ze])])]),t("div",Re,[t("label",Ge,_(e.value.documentType),1),o(y,{id:"name",modelValue:e.value.dni,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":r.value&&!e.value.dni||!N(e.value.dni)})},null,8,["modelValue","class"]),r.value&&!e.value.dni||!N(e.value.dni)?(f(),h("small",Oe,_(e.value.documentType)+" es requerido o formato inválido",1)):I("",!0)]),t("div",Ke,[Ze,o(y,{disabled:w.value,id:"name",modelValue:e.value.name,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":r.value&&!e.value.name})},null,8,["disabled","modelValue","class"]),r.value&&!e.value.name?(f(),h("small",He,"Nombre es requerido.")):I("",!0)]),t("div",Je,[Qe,o(y,{disabled:w.value,id:"name",modelValue:e.value.surnames,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":r.value&&!e.value.surnames})},null,8,["disabled","modelValue","class"]),r.value&&!e.value.surnames?(f(),h("small",We,"Apellido es requerido.")):I("",!0)]),t("div",Xe,[t("div",ea,[aa,o(ne,{showIcon:!0,showButtonBar:!0,modelValue:e.value.birthDate,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),r.value&&!e.value.birthDate?(f(),h("small",la,"Fecha de nacimiento es requerido.")):I("",!0)]),t("div",sa,[ta,o(y,{id:"phone",modelValue:e.value.phone,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.phone=l),modelModifiers:{trim:!0},class:P({"p-invalid":r.value&&!e.value.phone||!F(e.value.phone)})},null,8,["modelValue","class"]),r.value&&!e.value.phone||!F(e.value.phone)?(f(),h("small",oa," Teléfono es requerido o formato inválido")):I("",!0)])]),t("div",na,[t("div",ia,[da,o($,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.sex=l),options:z.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),t("div",ua,[ra,o($,{id:"civilStatus",modelValue:e.value.civilStatus,"onUpdate:modelValue":a[12]||(a[12]=l=>e.value.civilStatus=l),options:R.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),o(E,{visible:S.value,"onUpdate:visible":a[15]||(a[15]=l=>S.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[14]||(a[14]=l=>S.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ee})]),default:d(()=>[t("div",ca,[ma,e.value?(f(),h("span",va,[D("¿Estás seguro de que quieres eliminar "),t("b",null,_(e.value.name),1),D("?")])):I("",!0)])]),_:1},8,["visible"]),o(E,{visible:k.value,"onUpdate:visible":a[17]||(a[17]=l=>k.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[16]||(a[16]=l=>k.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:te})]),default:d(()=>[t("div",pa,[fa,e.value?(f(),h("span",ha,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):I("",!0)])]),_:1},8,["visible"])])])])}}},ga=de(_a,[["__scopeId","data-v-37e9f4e2"]]);export{ga as default};
