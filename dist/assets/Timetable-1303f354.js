import{_ as de,u as re,z as ce,r as d,p as ve,o as me,C as pe,q as be,a as p,b,c as h,d as s,k as t,s as o,t as r,l as v,B as V,n as I,f as y,w as he,x as fe,y as _e}from"./index-7e3665c5.js";import{u as ye}from"./dataUser-20fc8260.js";import{d as f}from"./day-a01efc22.js";const u=M=>(fe("data-v-df88ee97"),M=M(),_e(),M),Te={class:"grid"},ge={class:"col-12"},Se={class:"card"},De={class:"my-2"},we={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},xe={class:"m-0"},Ce={class:"block mt-2 md:mt-0 p-input-icon-left"},ke=u(()=>s("i",{class:"pi pi-search"},null,-1)),Ve=u(()=>s("span",{class:"p-column-title"},"Fecha",-1)),Ie=u(()=>s("span",{class:"p-column-title"},"Inicio",-1)),Me=u(()=>s("span",{class:"p-column-title"},"Fin",-1)),Ue=u(()=>s("span",{class:"p-column-title"},"Turnos",-1)),Ye=u(()=>s("span",{class:"p-column-title"},"Habilitado",-1)),qe={class:"field"},Ne=u(()=>s("label",{for:"dni"},"Días",-1)),He={key:0,class:"p-invalid"},Fe={class:"formgrid grid"},Ee={class:"field col"},Be=u(()=>s("label",{for:"startTime"},"Hora Inicio",-1)),Pe={key:0,class:"p-invalid"},$e={class:"field col"},Ae=u(()=>s("label",{for:"endTime"},"Hora Fin",-1)),Le={key:0,class:"p-invalid"},ze={class:"field"},je=u(()=>s("label",{for:"interval"},"Duracion por consulta (minutos)",-1)),Oe={key:0,class:"p-invalid"},Re={class:"formgrid grid"},Ge={class:"field col"},Ke=u(()=>s("label",{for:"capacity"},"Capacidad",-1)),Je={key:0,class:"p-invalid"},Qe={class:"field col"},We=u(()=>s("p",null,"Disponible",-1)),Xe=u(()=>s("p",{class:"text-yellow-600"},"Se debe liberar un turno previo aviso al paciente, consultar con admisión",-1)),Ze=u(()=>s("span",{class:"p-column-title"},"Turno",-1)),el=u(()=>s("span",{class:"p-column-title"},"Estado",-1)),ll=u(()=>s("span",{class:"p-column-title"},"Estado",-1)),al={class:"flex align-items-center justify-content-center"},tl=u(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),sl={key:0},ol={class:"flex align-items-center justify-content-center"},il=u(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),nl={key:0},ul={class:"flex align-items-center justify-content-center"},dl=u(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),rl={key:0},cl={class:"flex align-items-center justify-content-center"},vl=u(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ml={key:0},pl={__name:"Timetable",setup(M){const B=re(),O=ye(),U=ce(),R=d(null),_=d(null),Y=d(null),a=d(null);d(null);const g=d(null),q=d(null),w=d({}),x=d(!1),P=d(!1),N=d(!1),H=d(!1),C=d(null),$=d(null),F=d({}),c=d(!1),k=d(!1),E=d(!1);ve(()=>{ue()});const X=`listcolaborator-${f(new Date,"DD-MM-YYYY")}`;me(async()=>{_.value=pe.getItem("doctor"),_.value!==null&&_.value!==void 0?(R.value=_.value.user.name+" "+_.value.user.surnames,_.value.user.Doctor?(await U.getDoctorSchedule(_.value.user.Doctor.doctorId).then(i=>{Y.value=i.map(e=>{let T=f(e.startTime,"hh:mm A"),n=f(e.endTime,"hh:mm A");return e.startTime=T,e.endTime=n,e})}),console.log(Y.value)):console.error("No se encontraron datos del doctor en dataDoctor.")):console.error("No se encontraron datos en dataDoctor.")});const Z=()=>{a.value={day:null,startTime:null,endTime:null,interval:null,capacity:null,availableSchedule:!0,doctorId:_.value.user.Doctor.doctorId},g.value=null,c.value=!1,x.value=!0,he([()=>a.value.startTime,()=>a.value.endTime,()=>a.value.interval],([i,e,T])=>{if(i!==null&&e!==null&&T!==null){const n=new Date(i),A=new Date(e),L=T,m=(A-n)/(1e3*60);a.value.capacity=Math.floor(m/L)}else a.value.capacity=null})},G=()=>{x.value=!1,c.value=!1},ee=()=>a.value.startTime&&a.value.endTime&&a.value.interval&&a.value.capacity&&a.value.availableSchedule&&a.value.doctorId&&g.value,le=async()=>{for(const i of g.value){const e={...a.value,startTime:new Date(i.setHours(a.value.startTime.getHours(),a.value.startTime.getMinutes())),endTime:new Date(i.setHours(a.value.endTime.getHours(),a.value.endTime.getMinutes())),day:i};await U.addDoctorSchedule(e)}B.add({severity:"success",summary:"Éxito",detail:"Dias y turnos de citas generados correctamente",life:3e3}),await U.getDoctorSchedule(_.value.user.Doctor.doctorId).then(i=>{Y.value=i.map(e=>{let T=f(e.startTime,"hh:mm A"),n=f(e.endTime,"hh:mm A");return e.startTime=T,e.endTime=n,e})}),x.value=!1,a.value={}},K=async()=>{c.value=!0,ee()&&le()},ae=i=>{a.value={...i},P.value=!0},te=async()=>{q.value=q.value.filter(i=>i.accessId!==w.value.accessId),await O.disableUser(w.value.accessId),N.value=!1,w.value={},B.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},se=()=>{console.log($.value),$.value.exportCSV()},oe=i=>{a.value=i,k.value=!0},ie=i=>{console.log(i),E.value=!0},J=async i=>{console.log(i);let e={availableSchedule:i.availableSchedule};await U.updateSchedule(i.scheduleId,e),k.value=!1},ne=()=>{q.value=q.value.filter(e=>!C.value.includes(e)),C.value.map(e=>e.scheduleId).forEach(async e=>{await O.disableUser(e)}),H.value=!1,C.value=null,B.add({severity:"success",summary:"Successful",detail:"Colaboradores deshabilitados",life:3e3})},ue=()=>{F.value={global:{value:null,matchMode:be.CONTAINS}}};return(i,e)=>{const T=p("Toast"),n=p("Button"),A=p("Toolbar"),L=p("InputText"),m=p("Column"),z=p("InputSwitch"),Q=p("DataTable"),j=p("Calendar"),W=p("InputNumber"),S=p("Dialog");return b(),h("div",Te,[s("div",ge,[s("div",Se,[t(T),t(A,{class:"mb-4"},{start:o(()=>[s("div",De,[t(n,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:Z})])]),end:o(()=>[t(n,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:e[0]||(e[0]=l=>se(l))})]),_:1}),t(Q,{ref_key:"dt",ref:$,value:Y.value,selection:C.value,"onUpdate:selection":e[2]||(e[2]=l=>C.value=l),dataKey:"scheduleId",selectionMode:"multiple",paginator:!0,rows:10,filters:F.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Horarios",responsiveLayout:"scroll",exportFilename:X},{header:o(()=>[s("div",we,[s("h5",xe,"Gestión de Horarios Dr. "+r(R.value),1),s("span",Ce,[ke,t(L,{modelValue:F.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>F.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:o(()=>[t(m,{field:"day",header:"Fecha",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:o(l=>[Ve,v(" "+r(V(f)(l.data.day,"DD MMMM YYYY")),1)]),_:1}),t(m,{field:"startTime",header:"Inicio",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:o(l=>[Ie,v(" "+r(l.data.startTime),1)]),_:1}),t(m,{field:"endTime",header:"Fin",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:o(l=>[Me,v(" "+r(l.data.endTime),1)]),_:1}),t(m,{field:"capacity",header:"Turnos",sortable:!0,headerStyle:"width:14%; min-width:5rem;"},{body:o(l=>[Ue,v(" "+r(l.data.capacity),1)]),_:1}),t(m,{field:"availableSchedule",header:"Habilitado",sortable:!0,headerStyle:"width:14%; min-width:5rem;"},{body:o(l=>[Ye,t(z,{modelValue:l.data.availableSchedule,"onUpdate:modelValue":D=>l.data.availableSchedule=D,onChange:D=>oe(l.data)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:o(l=>[t(n,{icon:"pi pi-eye",class:"p-button-rounded p-button-success mr-2",onClick:D=>ae(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),t(S,{visible:x.value,"onUpdate:visible":e[9]||(e[9]=l=>x.value=l),style:{width:"500px"},header:"Horario de consultas",modal:!0,class:"p-fluid"},{footer:o(()=>[t(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:G}),t(n,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:K})]),default:o(()=>[s("div",qe,[Ne,t(j,{showIcon:!0,showButtonBar:!0,modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),dateFormat:"dd/mm/yy",required:"true",selectionMode:"multiple",class:I({"p-invalid":c.value&&!a.value.daysSchedule}),minDate:new Date},null,8,["modelValue","class","minDate"]),c.value&&!g.value?(b(),h("small",He,"Días es requerido.")):y("",!0)]),s("div",Fe,[s("div",Ee,[Be,t(j,{id:"calendar-timeonly",modelValue:a.value.startTime,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.startTime=l),timeOnly:"",hourFormat:"12",required:"true",showIcon:!0,manualInput:!0,class:I({"p-invalid":c.value&&!a.value.startTime})},null,8,["modelValue","class"]),c.value&&!a.value.startTime?(b(),h("small",Pe,"Hora inicio es requerido.")):y("",!0)]),s("div",$e,[Ae,t(j,{id:"calendar-timeonly",modelValue:a.value.endTime,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.endTime=l),timeOnly:"",hourFormat:"12",required:"true",showIcon:!0,manualInput:!0,class:I({"p-invalid":c.value&&!a.value.endTime})},null,8,["modelValue","class"]),c.value&&!a.value.endTime?(b(),h("small",Le,"Hora inicio es requerido.")):y("",!0)])]),s("div",ze,[je,t(W,{id:"interval",modelValue:a.value.interval,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.interval=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:I({"p-invalid":c.value&&!a.value.interval})},null,8,["modelValue","class"]),c.value&&!a.value.interval?(b(),h("small",Oe,"Intervalo es requerido.")):y("",!0)]),s("div",Re,[s("div",Ge,[Ke,t(W,{id:"capacity",modelValue:a.value.capacity,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.capacity=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:I({"p-invalid":c.value&&!a.value.capacity}),disabled:!0},null,8,["modelValue","class"]),c.value&&!a.value.capacity?(b(),h("small",Je,"Capacidad es requerido.")):y("",!0)]),s("div",Qe,[We,t(z,{modelValue:a.value.availableSchedule,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.availableSchedule=l)},null,8,["modelValue"])])])]),_:1},8,["visible"]),t(S,{visible:P.value,"onUpdate:visible":e[10]||(e[10]=l=>P.value=l),style:{width:"500px"},header:"Turnos de consulta",modal:!0,class:"p-fluid"},{footer:o(()=>[t(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:G}),t(n,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:K})]),default:o(()=>[s("h5",null,r(V(f)(a.value.day,"DD MMMM YYYY")),1),Xe,t(Q,{value:a.value.timeSlot,paginator:"",rows:5,rowsPerPageOptions:[5,10,20,50],tableStyle:"min-width: 25rem"},{default:o(()=>[t(m,{field:"nTurn",header:"Turno",style:{width:"5%"}}),t(m,{field:"orderlyTurn",header:"Hora",style:{width:"20%"}},{body:o(l=>[Ze,v(" "+r(V(f)(l.data.orderlyTurn,"hh:mm a")),1)]),_:1}),t(m,{field:"availableTurn",header:"Estado",style:{width:"30%"}},{body:o(l=>[el,v(" "+r(l.data.availableTurn?"Libre":"En Consulta"),1)]),_:1}),t(m,{field:"availableTurn",header:"Estado",style:{width:"25%"}},{body:o(l=>[ll,t(z,{modelValue:l.data.availableTurn,"onUpdate:modelValue":D=>l.data.availableTurn=D,onChange:D=>ie(l.data),disabled:""},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["value"])]),_:1},8,["visible"]),t(S,{visible:N.value,"onUpdate:visible":e[12]||(e[12]=l=>N.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[11]||(e[11]=l=>N.value=!1)}),t(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:te})]),default:o(()=>[s("div",al,[tl,a.value?(b(),h("span",sl,[v("¿Estás seguro de que quieres eliminar "),s("b",null,r(w.value.user.name),1),v("?")])):y("",!0)])]),_:1},8,["visible"]),t(S,{visible:k.value,"onUpdate:visible":e[15]||(e[15]=l=>k.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[13]||(e[13]=l=>(k.value=!1,a.value.availableSchedule=!a.value.availableSchedule))}),t(n,{label:"Si",icon:"pi pi-check",class:"p-button-text",onClick:e[14]||(e[14]=l=>J(a.value))})]),default:o(()=>[s("div",ol,[il,a.value?(b(),h("span",nl,[v("¿Estás seguro de querer "+r(a.value.availableSchedule?"habilitar":"deshabilitar")+" este horario del día ",1),s("b",null,r(V(f)(a.value.day,"DD MMMM YYYY")),1),v("?")])):y("",!0)])]),_:1},8,["visible"]),t(S,{visible:E.value,"onUpdate:visible":e[18]||(e[18]=l=>E.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[16]||(e[16]=l=>(E.value=!1,a.value.timeSlot.availableTurn=!a.value.timeSlot.availableTurn))}),t(n,{label:"Si",icon:"pi pi-check",class:"p-button-text",onClick:e[17]||(e[17]=l=>J(a.value))})]),default:o(()=>[s("div",ul,[dl,a.value?(b(),h("span",rl,[v("¿Estás seguro de querer "),s("b",null,r(a.value.timeSlot.availableTurn?"habilitar":"deshabilitar"),1),v(" "+r(a.value)+" este horario del día ",1),s("b",null,r(V(f)(a.value.day,"DD MMMM YYYY")),1),v("?")])):y("",!0)])]),_:1},8,["visible"]),t(S,{visible:H.value,"onUpdate:visible":e[20]||(e[20]=l=>H.value=l),style:{width:"450px"},header:"Confirmar",modal:!0},{footer:o(()=>[t(n,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:e[19]||(e[19]=l=>H.value=!1)}),t(n,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ne})]),default:o(()=>[s("div",cl,[vl,w.value?(b(),h("span",ml,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):y("",!0)])]),_:1},8,["visible"])])])])}}},_l=de(pl,[["__scopeId","data-v-df88ee97"]]);export{_l as default};
