import{_ as W,u as X,h as ee,r,m as te,w as ae,o as le,p as se,a as c,b as y,c as x,d as l,e as s,q as i,j as g,t as f,n as B,l as I,s as oe,v as ne,x as de}from"./index-ec84c2a8.js";import{u as ie}from"./dataUser-69dfe82f.js";import{d as U,a as ue}from"./day-a01efc22.js";const n=M=>(ne("data-v-aca04c16"),M=M(),de(),M),re={class:"grid"},ce={class:"col-12"},me={class:"card"},pe={class:"my-2"},ve={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},_e=n(()=>l("h5",{class:"m-0"},"Administrar dependientes",-1)),fe={class:"block mt-2 md:mt-0 p-input-icon-left"},he=n(()=>l("i",{class:"pi pi-search"},null,-1)),be=n(()=>l("span",{class:"p-column-title"},"DNI",-1)),De=n(()=>l("span",{class:"p-column-title"},"Name",-1)),ye=n(()=>l("span",{class:"p-column-title"},"Apellidos",-1)),xe=n(()=>l("span",{class:"p-column-title"},"Fecha Nacimiento",-1)),ge=n(()=>l("span",{class:"p-column-title"},"Sexo",-1)),we={class:"field"},Ie=n(()=>l("label",{class:"mb-3"},"Tipo de documento",-1)),Ve={class:"formgrid grid"},ke={class:"field-radiobutton col-4"},Ce=n(()=>l("label",{for:"dni"},"DNI",-1)),Me={class:"field-radiobutton col-4"},Ne=n(()=>l("label",{for:"ce"},"CE",-1)),Te={class:"field-radiobutton col-4"},Se=n(()=>l("label",{for:"pasaport"},"Pasaporte",-1)),Ue={class:"field"},Ye={for:"dni"},Pe={key:0,class:"p-invalid"},qe={class:"field"},Be=n(()=>l("label",{for:"name"},"Nombre",-1)),Ee={key:0,class:"p-invalid"},Fe={class:"field"},Ae=n(()=>l("label",{for:"name"},"Apellidos",-1)),Le={key:0,class:"p-invalid"},$e={class:"formgrid grid"},ze={class:"field col"},je=n(()=>l("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),Oe={key:0,class:"p-invalid"},Re={class:"field col"},Ge=n(()=>l("label",{for:"sex"},"Sexo",-1)),Ke={class:"flex align-items-center justify-content-center"},Ze=n(()=>l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),He={key:0},Je={class:"flex align-items-center justify-content-center"},Qe=n(()=>l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),We={key:0},Xe={__name:"Dependents",setup(M){const h=X(),N=ie(),Y=ee(),m=r(null),w=r(!1),V=r(!1),k=r(!1),e=r({}),b=r(null),E=r(null),T=r({}),u=r(!1),F=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]);te(()=>{Z()}),ae([()=>e.value.dni],async([o])=>{S(o)&&e.value.documentType==="DNI"&&A(o)});const A=async o=>{const t=await Y.searchbydni(o);t?(e.value.name=(t==null?void 0:t.nombres)||"",e.value.surnames=(t==null?void 0:t.apellidop)+" "+(t==null?void 0:t.apellidom),h.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.dni="",e.value.name="",e.value.surnames="",h.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))};le(async()=>{const o=Y.user.username;await N.getUsersDependents(o).then(t=>{m.value=t.map(D=>{let d=U(D.birthDate,"DD MMMM YYYY");return D.birthDate=d,D})})});const L=()=>{e.value={},e.value.documentType="DNI",u.value=!1,w.value=!0},$=()=>{w.value=!1,u.value=!1},S=o=>e.value.documentType==="DNI"?/^\d{8}$/.test(o):e.value.documentType==="CE"?/^\d{9}$/.test(o):e.value.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(o):!0,z=async()=>{u.value=!0;const{name:o,surnames:t,dni:D,birthDate:d,sex:P,dependentId:_}=e.value;if(o&&o.trim()&&t&&D&&d&&P&&S(e.value.dni)){const p=Y.user.userId;if(e.value.userId=p,e.value.birthDate=new Date(ue(d)),_){const v=m.value.findIndex(C=>C.dependentId===_);v!==-1&&(await oe(_,e.value),e.value.birthDate=U(e.value.birthDate,"DD MMMM YYYY"),m.value[v]=e.value,h.add({severity:"success",summary:"Éxito",detail:"Dependiente Actualizado",life:3e3}))}else{const v=await N.addUsersDependents(e.value);console.log(v),v.dependentId?(e.value.dependentId=v.dependentId,e.value.birthDate=U(e.value.birthDate,"DD MMMM YYYY"),m.value.push(e.value),h.add({severity:"success",summary:"Éxito",detail:"Dependiente Registrado",life:3e3})):h.add({severity:"error",summary:"Error",detail:v,life:3e3})}w.value=!1,e.value={}}},j=o=>{e.value={...o},e.value.birthDate=U(e.value.birthDate,"DD MMMM YYYY"),w.value=!0},O=o=>{e.value=o,V.value=!0},R=async()=>{m.value=m.value.filter(o=>o.dependentId!==e.value.dependentId),await N.deleteUserDependents(e.value.dependentId),V.value=!1,e.value={},h.add({severity:"success",summary:"Éxito",detail:"Dependiente eliminado",life:3e3})},G=()=>{k.value=!0},K=()=>{m.value=m.value.filter(t=>!b.value.includes(t)),b.value.map(t=>t.dependentId).forEach(async t=>{await N.deleteUserDependents(t)}),k.value=!1,b.value=null,h.add({severity:"success",summary:"Éxito",detail:"Dependientes eliminados",life:3e3})},Z=()=>{T.value={global:{value:null,matchMode:se.CONTAINS}}};return(o,t)=>{const D=c("Toast"),d=c("Button"),P=c("Toolbar"),_=c("InputText"),p=c("Column"),v=c("DataTable"),C=c("RadioButton"),H=c("Calendar"),J=c("Dropdown"),q=c("Dialog");return y(),x("div",re,[l("div",ce,[l("div",me,[s(D),s(P,{class:"mb-4"},{start:i(()=>[l("div",pe,[s(d,{label:"Nuevo Dependiente",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:L}),s(d,{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:G,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),_:1}),s(v,{ref_key:"dt",ref:E,value:m.value,selection:b.value,"onUpdate:selection":t[1]||(t[1]=a=>b.value=a),dataKey:"dependentId",paginator:!0,rows:10,filters:T.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando del  {first} al {last} de {totalRecords} dependientes",responsiveLayout:"scroll"},{header:i(()=>[l("div",ve,[_e,l("span",fe,[he,s(_,{modelValue:T.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=a=>T.value.global.value=a),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:i(()=>[s(p,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(p,{field:"dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(a=>[be,g(" "+f(a.data.dni),1)]),_:1}),s(p,{field:"name",header:"Name",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(a=>[De,g(" "+f(a.data.name),1)]),_:1}),s(p,{field:"surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(a=>[ye,g(" "+f(a.data.surnames),1)]),_:1}),s(p,{field:"birthDate",header:"Fecha Nacimiento",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(a=>[xe,g(" "+f(a.data.birthDate),1)]),_:1}),s(p,{field:"sex",header:"Sexo",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(a=>[ge,g(" "+f(a.data.sex),1)]),_:1}),s(p,{headerStyle:"min-width:10rem;"},{body:i(a=>[s(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:Q=>j(a.data)},null,8,["onClick"]),s(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:Q=>O(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),s(q,{visible:w.value,"onUpdate:visible":t[10]||(t[10]=a=>w.value=a),style:{width:"450px"},header:"Datos de usuario",modal:!0,class:"p-fluid"},{footer:i(()=>[s(d,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:$}),s(d,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:z})]),default:i(()=>[l("div",we,[Ie,l("div",Ve,[l("div",ke,[s(C,{id:"dni",name:"option",value:"DNI",modelValue:e.value.documentType,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.documentType=a)},null,8,["modelValue"]),Ce]),l("div",Me,[s(C,{id:"ce",name:"option",value:"CE",modelValue:e.value.documentType,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.documentType=a)},null,8,["modelValue"]),Ne]),l("div",Te,[s(C,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.documentType,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.documentType=a)},null,8,["modelValue"]),Se])])]),l("div",Ue,[l("label",Ye,f(e.value.documentType),1),s(_,{id:"name",modelValue:e.value.dni,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.dni=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:B({"p-invalid":u.value&&!e.value.dni||!S(e.value.dni)})},null,8,["modelValue","class"]),u.value&&!e.value.dni||!S(e.value.dni)?(y(),x("small",Pe,f(e.value.documentType)+" es requerido o formato inválido",1)):I("",!0)]),l("div",qe,[Be,s(_,{id:"name",modelValue:e.value.name,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.name=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:B({"p-invalid":u.value&&!e.value.name})},null,8,["modelValue","class"]),u.value&&!e.value.name?(y(),x("small",Ee,"Nombre es requerido.")):I("",!0)]),l("div",Fe,[Ae,s(_,{id:"name",modelValue:e.value.surnames,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value.surnames=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:B({"p-invalid":u.value&&!e.value.surnames})},null,8,["modelValue","class"]),u.value&&!e.value.surnames?(y(),x("small",Le,"Apellido es requerido.")):I("",!0)]),l("div",$e,[l("div",ze,[je,s(H,{showIcon:!0,showButtonBar:!0,modelValue:e.value.birthDate,"onUpdate:modelValue":t[8]||(t[8]=a=>e.value.birthDate=a),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),u.value&&!e.value.birthDate?(y(),x("small",Oe,"Fecha de nacimiento es requerido.")):I("",!0)]),l("div",Re,[Ge,s(J,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":t[9]||(t[9]=a=>e.value.sex=a),options:F.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),s(q,{visible:V.value,"onUpdate:visible":t[12]||(t[12]=a=>V.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[s(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[11]||(t[11]=a=>V.value=!1)}),s(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:R})]),default:i(()=>[l("div",Ke,[Ze,e.value?(y(),x("span",He,[g("¿Estás seguro de que quieres eliminar a "),l("b",null,f(e.value.name),1),g("?")])):I("",!0)])]),_:1},8,["visible"]),s(q,{visible:k.value,"onUpdate:visible":t[14]||(t[14]=a=>k.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[s(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[13]||(t[13]=a=>k.value=!1)}),s(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:K})]),default:i(()=>[l("div",Je,[Qe,e.value?(y(),x("span",We,"¿Está seguro de que desea eliminar los dependientes seleccionados?")):I("",!0)])]),_:1},8,["visible"])])])])}}},lt=W(Xe,[["__scopeId","data-v-aca04c16"]]);export{lt as default};
