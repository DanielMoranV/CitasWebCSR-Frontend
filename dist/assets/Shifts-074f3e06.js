import{_ as de,u as re,h as ue,y as ce,r,m as me,w as pe,o as he,p as V,D as ve,a as m,b as S,c as Y,d as s,e as l,q as i,j as p,t as u,n as _e,A as O,B as j,l as x,v as fe,x as ye}from"./index-a19affa2.js";import{u as ge}from"./dataAppointment-4893227b.js";import{u as be}from"./dataAdmissionist-4f098c90.js";import{u as we}from"./dataUser-b752686d.js";import{d as q}from"./day-a01efc22.js";const c=b=>(fe("data-v-c1970aff"),b=b(),ye(),b),Ie={class:"grid"},Ce={class:"col-12"},Se={class:"card"},Ae={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},De=c(()=>s("h5",{class:"m-0"},"Citas Médicas",-1)),Te={class:"block mt-2 md:mt-0 p-input-icon-left"},Me=c(()=>s("i",{class:"pi pi-search"},null,-1)),Ne=c(()=>s("span",{class:"p-column-title"},"Nº Turno",-1)),Pe=c(()=>s("span",{class:"p-column-title"},"Paciente",-1)),Ve=c(()=>s("span",{class:"p-column-title"},"Estado",-1)),xe=c(()=>s("span",{class:"p-column-title"},"Médico",-1)),ke={class:"p-multiselect-representative-option"},Ee={style:{"margin-left":"0.5em","vertical-align":"middle"},class:"image-text"},Fe=c(()=>s("span",{class:"p-column-title"},"Especialidad",-1)),Le=c(()=>s("span",{class:"p-column-title"},"Origen",-1)),Re=c(()=>s("span",{class:"p-column-title"},"Fecha Consulta",-1)),Ue={class:"flex align-items-center justify-content-center"},$e=c(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ze={key:0},Be={class:"mb-1"},Ye={class:"mb-1"},Oe={class:"mb-1"},je={class:"mb-1"},qe={class:"field col-12 md:col-12 mt-12 mt-4"},He={class:"p-float-label"},Ke=c(()=>s("label",{for:"autocomplete"},"Paciente",-1)),Ge={__name:"Shifts",setup(b){const A=re(),k=ue(),H=we(),K=ce(),E=be(),_=ge(),F=r([]),w=r([]),n=r(null),L=r(null),y=r({}),D=r(null),I=r(!1),g=r(!1),R=r(!0),U=r(null),T=r(null),f=r(null),$=r([]),M=r(!0),N=r(null),P=r({amount:null,paymentDate:null,appointmentId:null,paymentMethodId:null,VoucherTypeId:null,userId:null});me(()=>Q());const G=()=>L.value.exportCSV(),J=t=>{const a=t.query.toLowerCase();$.value=a.trim().length?T.value.filter(o=>o.fullName.toLowerCase().includes(a)):[...T.value]};pe(f,t=>{console.log(t),t!=null&&(M.value=!1)}),he(async()=>{await K.getDoctors().then(t=>{F.value=t.map(a=>(a.name=`${a.user.surnames} ${a.user.name}`,a))}),w.value=await _.getAppointment(),z(),D.value=!1,U.value=await H.getPatients(),T.value=te(U.value),R.value=!1,N.value=await E.getTodayCashRegisterForAdmissionist(k.user.accessId)});const Q=()=>{y.value={global:{value:null,matchMode:V.CONTAINS},nameDoctor:{value:null,matchMode:V.IN},orderlyTurn:{operator:ve.AND,constraints:[{value:null,matchMode:V.DATE_IS}]}}},W=t=>{n.value=t,console.log(n.value),g.value=!0},X=async()=>{await _.deleteAppointmentId(n.value.Appointment[0].appointmentId),g.value=!1,n.value={},A.add({severity:"success",summary:"Éxito",detail:"Cita médica eliminada",life:3e3})},Z=async t=>{N.value!==null?(n.value=t,I.value=!0,M.value=!0,f.value=null,console.log(n.value)):A.add({severity:"error",summary:"Error",detail:"Caja registradora NO APERTURADA",life:4e3})},ee=async()=>{const t=ae();let a=await _.addappointment(t);console.log(a.value),w.value=await _.getAppointment(),z();let o=await _.getLastPayment();o=Number(o.paymentId)+1,P.value={amount:Number(n.value.price)*100,voucherNumber:"000"+o,paymentDate:new Date,appointmentId:a.appointmentId,paymentMethodId:1,VoucherTypeId:5,userId:a.userId,admissionistId:k.user.accessId,chargeId:null},console.log(P.value);let d=await _.createPaymentCash(P.value),C={transactionDate:new Date,transactionType:"Ingreso",amount:d.amount,cashRegisterId:N.value.cashRegisterId,voucherNumber:d.voucherNumber,paymentId:d.paymentId,category:"Consultas Médicas"};console.log(C),await E.createCashRegisterTransaction(C),I.value=!1,A.add({severity:"success",summary:"Éxito",detail:"Cita médica pagada correctamente",life:3e3})};function z(){w.value.forEach(t=>{t.orderlyTurn=new Date(t.orderlyTurn),t.specialization=t.Schedule.doctor.specialization,t.nameDoctor=`${t.Schedule.doctor.user.surnames} ${t.Schedule.doctor.user.name}`,t.price=t.Schedule.doctor.personalizedPrices[0].personalizedPrice,t.Appointment[0]&&(t.status=t.Appointment[0].status,t.origin=t.Appointment[0].origin,t.Appointment[0].dependent?t.patient=`${t.Appointment[0].dependent.name} ${t.Appointment[0].dependent.surnames}`:t.patient=`${t.Appointment[0].user.name} ${t.Appointment[0].user.surnames}`)})}function te(t){const a=[];return t.forEach(o=>{a.push({userId:o.user.userId,fullName:o.user.name+" "+o.user.surnames+" "+o.user.dni,dependents:o.user.dependents,name:o.user.name,surnames:o.user.surnames,address:o.user.address,phone:o.user.phone}),o.user.dependents.length&&o.user.dependents.forEach(d=>{a.push({userId:d.userId,fullName:d.name+" "+d.surnames+" "+d.dni,dependentId:d.dependentId,name:o.user.name,surnames:o.user.surnames,address:o.user.address,phone:o.user.phone})})}),a}function ae(){return{origin:"admisión",status:"pendiente",createAt:new Date,doctorId:n.value.Schedule.doctor.doctorId,userId:f.value.userId,dependentId:f.value.dependentId,timeSlotId:n.value.timeSlotId,appointmentServices:{create:[{medicalServiceId:1}]}}}return(t,a)=>{const o=m("Toast"),d=m("Button"),C=m("Toolbar"),se=m("InputText"),h=m("Column"),oe=m("MultiSelect"),le=m("Calendar"),ne=m("DataTable"),B=m("Dialog"),ie=m("AutoComplete");return S(),Y("div",Ie,[s("div",Ce,[s("div",Se,[l(o),l(C,{class:"mb-4"},{end:i(()=>[l(d,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:a[0]||(a[0]=e=>G(e))})]),_:1}),l(ne,{ref_key:"dt",ref:L,value:w.value,dataKey:"timeSlotId",paginator:!0,rows:10,rowHover:!0,filters:y.value,"onUpdate:filters":a[2]||(a[2]=e=>y.value=e),filterDisplay:"menu",loading:D.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando del  {first} al {last} de {totalRecords} Atenciones",globalFilterFields:["nTurn","patient","status","nameDoctor","status","specialization","orderlyTurn","origin"],responsiveLayout:"scroll"},{header:i(()=>[s("div",Ae,[De,s("span",Te,[Me,l(se,{modelValue:y.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),empty:i(()=>[p("No se encontraron citas médicas ")]),loading:i(()=>[p(" Cargando datos. Espere por favor. ")]),default:i(()=>[l(h,{field:"nTurn",header:"Nº Turno",sortable:!0,headerStyle:"width:10%; min-width:2rem;"},{body:i(e=>[Ne,p(" "+u(e.data.nTurn),1)]),_:1}),l(h,{field:"patient",header:"Paciente",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(e=>[Pe,p(" "+u(e.data.patient),1)]),_:1}),l(h,{field:"status",header:"Estado",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(e=>[Ve,s("span",{class:_e("user-badge status-"+(e.data.status?e.data.status.toLowerCase():""))},u(e.data.status||"Disponible"),3)]),_:1}),l(h,{field:"nameDoctor",header:"Médico",sortable:!0,showFilterMatchModes:!1,headerStyle:"width:14%; min-width:10rem;"},{body:i(e=>[xe,p(" "+u(e.data.nameDoctor),1)]),filter:i(({filterModel:e})=>[l(oe,{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,options:F.value,optionLabel:"name",optionValue:"name",placeholder:"Buscar Por Médico",class:"p-column-filter"},{option:i(v=>[s("div",ke,[s("span",Ee,u(v.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(h,{field:"specialization",header:"Especialidad",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(e=>[Fe,p(" "+u(e.data.specialization),1)]),_:1}),l(h,{field:"origin",header:"Origen",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(e=>[Le,p(" "+u(e.data.origin),1)]),_:1}),l(h,{field:"orderlyTurn",header:"Fecha Consulta",showFilterMatchModes:!1,sortable:!0,headerStyle:"width:15%; min-width:10rem;"},{body:i(e=>[Re,p(" "+u(O(q)(e.data.orderlyTurn,"DD MMMM YYYY hh:mm a")),1)]),filter:i(({filterModel:e})=>[l(le,{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(h,{headerStyle:"width:10%; min-width:5rem;",header:"Acciones"},{body:i(e=>[e.data.status?(S(),j(d,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2 mr-2",onClick:v=>W(e.data)},null,8,["onClick"])):x("",!0),e.data.status?x("",!0):(S(),j(d,{key:1,icon:"pi pi-calendar-plus",class:"p-button-rounded p-button-success mt-2",onClick:v=>Z(e.data)},null,8,["onClick"]))]),_:1})]),_:1},8,["value","filters","loading"]),l(B,{visible:g.value,"onUpdate:visible":a[4]||(a[4]=e=>g.value=e),style:{width:"450px"},header:"Eliminar Cita",modal:!0},{footer:i(()=>[l(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[3]||(a[3]=e=>g.value=!1)}),l(d,{label:"Si",icon:"pi pi-check",class:"p-button-text",onClick:X})]),default:i(()=>[s("div",Ue,[$e,n.value?(S(),Y("span",ze,[p("Estás seguro de que quieres eliminar atención Nº "),s("b",null,u(n.value.Appointment[0].appointmentId),1),p("?")])):x("",!0)])]),_:1},8,["visible"]),l(B,{visible:I.value,"onUpdate:visible":a[7]||(a[7]=e=>I.value=e),style:{width:"450px"},header:"Agendar Consulta Médica",modal:!0,class:"grid p-fluid"},{default:i(()=>[s("p",Be,"Medico : "+u(n.value?n.value.nameDoctor:"No disponible"),1),s("p",Ye,"Especialidad : "+u(n.value?n.value.specialization:"No disponible"),1),s("p",Oe,"Fecha: "+u(n.value?O(q)(n.value.orderlyTurn,"DD MMMM YYYY hh:mm A"):"No disponible"),1),s("p",je,"Total : S/ "+u(n.value?n.value.price:"No disponible"),1),s("div",qe,[s("span",He,[l(ie,{id:"patients",dropdown:!0,modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=e=>f.value=e),suggestions:$.value,onComplete:a[6]||(a[6]=e=>J(e)),field:"fullName",disabled:R.value},null,8,["modelValue","suggestions","disabled"]),Ke])]),l(d,{label:"Pagar Consulta Médica",icon:"pi pi-money-bill",class:"p-button-default col-12 mb-2",disabled:M.value,loading:D.value,onClick:ee},null,8,["disabled","loading"])]),_:1},8,["visible"])])])])}}},et=de(Ge,[["__scopeId","data-v-c1970aff"]]);export{et as default};
