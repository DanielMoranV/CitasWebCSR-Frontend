import{_ as ue,u as ie,h as de,r,w as re,m as ce,o as me,p as pe,a as c,b as _,c as f,d as a,e as t,q as u,j as w,t as h,n as k,l as I,v as ve,x as _e}from"./index-ec84c2a8.js";import{u as fe}from"./dataUser-69dfe82f.js";import{d as Y,a as he}from"./day-a01efc22.js";import{r as be,u as ye}from"./xlsx-04f2268f.js";const n=C=>(ve("data-v-3d34305d"),C=C(),_e(),C),Ie={class:"grid"},xe={class:"col-12"},ge={class:"card"},we={class:"my-2"},De={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ve=n(()=>a("h5",{class:"m-0"},"Gestión de usuarios",-1)),Ue={class:"block mt-2 md:mt-0 p-input-icon-left"},ke=n(()=>a("i",{class:"pi pi-search"},null,-1)),Ce=n(()=>a("span",{class:"p-column-title"},"DNI",-1)),Ne=n(()=>a("span",{class:"p-column-title"},"Nombre",-1)),Se=n(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),Te=n(()=>a("span",{class:"p-column-title"},"Rol",-1)),Me=n(()=>a("span",{class:"p-column-title"},"Status",-1)),Ae={class:"field"},Pe=n(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),qe={class:"formgrid grid"},Fe={class:"field-radiobutton col-4"},Be=n(()=>a("label",{for:"dni"},"DNI",-1)),Le={class:"field-radiobutton col-4"},$e=n(()=>a("label",{for:"ce"},"CE",-1)),Ye={class:"field-radiobutton col-4"},Ee=n(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Re={class:"field"},je={for:"dni"},ze={key:0,class:"p-invalid"},Ge={class:"field"},Oe=n(()=>a("label",{for:"name"},"Nombre",-1)),Ke={key:0,class:"p-invalid"},Ze={class:"field"},He=n(()=>a("label",{for:"name"},"Apellidos",-1)),Je={key:0,class:"p-invalid"},Qe={class:"formgrid grid"},We={class:"field col"},Xe=n(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),es={key:0,class:"p-invalid"},ss={class:"field col"},ls=n(()=>a("label",{for:"phone"},"Teléfono",-1)),as={key:0,class:"p-invalid"},os={class:"formgrid grid"},ts={class:"field col"},ns=n(()=>a("label",{for:"sex"},"Sexo",-1)),us={class:"field col"},is=n(()=>a("label",{for:"role"},"Rol",-1)),ds={class:"flex align-items-center justify-content-center"},rs=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),cs={key:0},ms={class:"flex align-items-center justify-content-center"},ps=n(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),vs={key:0},_s={__name:"Users",setup(C){const x=ie(),D=fe(),E=de(),m=r(null),e=r({user:{dni:null}}),g=r(!1),V=r(!1),U=r(!1),b=r(null),M=r(null),N=r({}),i=r(!1),R=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),j=r([{name:"Administrador",code:1},{name:"Admisionista",code:2}]);re([()=>e.value.user.dni],async([o])=>{S(o)&&e.value.user.documentType==="DNI"&&z(o)});const z=async o=>{const s=await E.searchbydni(o);s?(e.value.user.name=(s==null?void 0:s.nombres)||"",e.value.user.surnames=(s==null?void 0:s.apellidop)+" "+(s==null?void 0:s.apellidom),x.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.user.dni="",e.value.user.name="",e.value.user.surnames="",x.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},A=r({1:"Administrador",2:"Admisionista"}),P=o=>/^[0-9]{9}$/.test(o),S=o=>e.value.user.documentType==="DNI"?/^\d{8}$/.test(o):e.value.user.documentType==="CE"?/^\d{9}$/.test(o):e.value.user.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(o):!0;ce(()=>{oe()});const G=`listcolaborator-${Y(new Date,"DD-MM-YYYY")}`;me(async()=>{await D.getCollaborators().then(o=>{m.value=o.map(s=>{let v=Y(s.user.birthDate,"DD MMMM YYYY");return s.user.birthDate=v,s.roleName=A.value[s.roleId],s})}),console.log(m.value)});const O=()=>{e.value={accessId:null,active:null,createAt:null,lastSession:null,password:null,roleId:null,roleName:null,status:null,user:{address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null}},i.value=!1,g.value=!0},K=()=>{g.value=!1,i.value=!1},Z=()=>{const o=e.value.user;return o.name&&o.name.trim()&&o.surnames&&o.dni&&o.birthDate&&o.sex&&S(o.dni)&&P(o.phone)},H=async()=>{const o={address:e.value.user.address,birthDate:he(new Date(e.value.user.birthDate)),civilStatus:e.value.user.civilStatus,dni:e.value.user.dni,documentType:e.value.user.documentType,email:e.value.user.email,name:e.value.user.name,phone:e.value.user.phone,photo:e.value.user.photo,sex:e.value.user.sex,surnames:e.value.user.surnames,access:{username:`${e.value.user.dni}-${e.value.roleId}`,password:e.value.user.dni,roleId:e.value.roleId}};if(e.value.accessId){const s=m.value.findIndex(v=>v.accessId===e.value.accessId);s!==-1&&(o.access.accessId=e.value.accessId,o.userId=e.value.user.userId,await D.updateUser(o.dni,o.access.accessId,o),e.value.roleName=A.value[e.value.roleId],m.value[s]=e.value,x.add({severity:"success",summary:"Éxito",detail:"Colaborador Actualizado",life:3e3}))}else{const s=await D.addUsers(o);e.value.accessId=s.access[0].accessId,e.value.roleName=A.value[e.value.roleId],e.value.status="offline",m.value.push(e.value),x.add({severity:"success",summary:"Éxito",detail:"Colaborador Registrado",life:3e3})}g.value=!1,e.value={user:{dni:null}},i.value=!1},J=async()=>{i.value=!0,Z()&&H()},Q=o=>{e.value={...o},g.value=!0},W=o=>{e.value=o,V.value=!0},X=async()=>{m.value=m.value.filter(o=>o.accessId!==e.value.accessId),await D.disableUser(e.value.accessId),V.value=!1,e.value={user:{dni:null}},x.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},ee=()=>{console.log(M.value),M.value.exportCSV()},se=o=>{const s=o.files[0],v=new FileReader;v.onload=d=>{const q=new Uint8Array(d.target.result),T=be(q,{type:"array"}),y=T.SheetNames[0],p=T.Sheets[y],F=ye.sheet_to_json(p);console.log(F)},v.readAsArrayBuffer(s)},le=()=>{U.value=!0},ae=()=>{m.value=m.value.filter(s=>!b.value.includes(s)),b.value.map(s=>s.accessId).forEach(async s=>{await D.disableUser(s)}),U.value=!1,b.value=null,x.add({severity:"success",summary:"Successful",detail:"Colaboradores deshabilitados",life:3e3})},oe=()=>{N.value={global:{value:null,matchMode:pe.CONTAINS}}};return(o,s)=>{const v=c("Toast"),d=c("Button"),q=c("FileUpload"),T=c("Toolbar"),y=c("InputText"),p=c("Column"),F=c("DataTable"),B=c("RadioButton"),te=c("Calendar"),$=c("Dropdown"),L=c("Dialog");return _(),f("div",Ie,[a("div",xe,[a("div",ge,[t(v),t(T,{class:"mb-4"},{start:u(()=>[a("div",we,[t(d,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:O}),t(d,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:le,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:u(()=>[t(q,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:se}),t(d,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:s[0]||(s[0]=l=>ee(l))})]),_:1}),t(F,{ref_key:"dt",ref:M,value:m.value,selection:b.value,"onUpdate:selection":s[2]||(s[2]=l=>b.value=l),dataKey:"accessId",paginator:!0,rows:10,filters:N.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Colaboradores",responsiveLayout:"scroll",exportFilename:G},{header:u(()=>[a("div",De,[Ve,a("span",Ue,[ke,t(y,{modelValue:N.value.global.value,"onUpdate:modelValue":s[1]||(s[1]=l=>N.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:u(()=>[t(p,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(p,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ce,w(" "+h(l.data.user.dni),1)]),_:1}),t(p,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Ne,w(" "+h(l.data.user.name),1)]),_:1}),t(p,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Se,w(" "+h(l.data.user.surnames),1)]),_:1}),t(p,{field:"roleName",header:"Rol",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Te,w(" "+h(l.data.roleName),1)]),_:1}),t(p,{field:"status",header:"Status",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Me,a("span",{class:k("user-badge status-"+(l.data.status?l.data.status.toLowerCase():""))},h(l.data.status),3)]),_:1}),t(p,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:u(l=>[t(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:ne=>Q(l.data)},null,8,["onClick"]),t(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:ne=>W(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),t(L,{visible:g.value,"onUpdate:visible":s[13]||(s[13]=l=>g.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:u(()=>[t(d,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:K}),t(d,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:J})]),default:u(()=>[a("div",Ae,[Pe,a("div",qe,[a("div",Fe,[t(B,{id:"dni",name:"option",value:"DNI",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Be]),a("div",Le,[t(B,{id:"ce",name:"option",value:"CE",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),$e]),a("div",Ye,[t(B,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.user.documentType,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.user.documentType=l)},null,8,["modelValue"]),Ee])])]),a("div",Re,[a("label",je,h(e.value.user.documentType),1),t(y,{id:"dni",modelValue:e.value.user.dni,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.user.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.dni||!S(e.value.user.dni)})},null,8,["modelValue","class"]),i.value&&!e.value.user.dni||!S(e.value.user.dni)?(_(),f("small",ze,h(e.value.user.documentType)+" es requerido o formato inválido",1)):I("",!0)]),a("div",Ge,[Oe,t(y,{id:"name",modelValue:e.value.user.name,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.user.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.name})},null,8,["modelValue","class"]),i.value&&!e.value.name?(_(),f("small",Ke,"Nombre es requerido.")):I("",!0)]),a("div",Ze,[He,t(y,{id:"name",modelValue:e.value.user.surnames,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.user.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:k({"p-invalid":i.value&&!e.value.user.surnames})},null,8,["modelValue","class"]),i.value&&!e.value.user.surnames?(_(),f("small",Je,"Apellido es requerido.")):I("",!0)]),a("div",Qe,[a("div",We,[Xe,t(te,{showIcon:!0,showButtonBar:!0,modelValue:e.value.user.birthDate,"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.user.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),i.value&&!e.value.birthDate?(_(),f("small",es,"Fecha de nacimiento es requerido.")):I("",!0)]),a("div",ss,[ls,t(y,{id:"phone",modelValue:e.value.user.phone,"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.user.phone=l),modelModifiers:{trim:!0},class:k({"p-invalid":i.value&&!e.value.user.phone||!P(e.value.user.phone)})},null,8,["modelValue","class"]),i.value&&!e.value.user.phone||!P(e.value.user.phone)?(_(),f("small",as," Teléfono es requerido o formato inválido")):I("",!0)])]),a("div",os,[a("div",ts,[ns,t($,{id:"sex",modelValue:e.value.user.sex,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.user.sex=l),options:R.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),a("div",us,[is,t($,{id:"role",modelValue:e.value.roleId,"onUpdate:modelValue":s[12]||(s[12]=l=>e.value.roleId=l),options:j.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),t(L,{visible:V.value,"onUpdate:visible":s[15]||(s[15]=l=>V.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[t(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[14]||(s[14]=l=>V.value=!1)}),t(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:X})]),default:u(()=>[a("div",ds,[rs,e.value?(_(),f("span",cs,[w("¿Estás seguro de que quieres eliminar "),a("b",null,h(e.value.user.name),1),w("?")])):I("",!0)])]),_:1},8,["visible"]),t(L,{visible:U.value,"onUpdate:visible":s[17]||(s[17]=l=>U.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:u(()=>[t(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:s[16]||(s[16]=l=>U.value=!1)}),t(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ae})]),default:u(()=>[a("div",ms,[ps,e.value?(_(),f("span",vs,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):I("",!0)])]),_:1},8,["visible"])])])])}}},Is=ue(_s,[["__scopeId","data-v-3d34305d"]]);export{Is as default};
