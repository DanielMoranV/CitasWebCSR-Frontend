import{_ as Q,u as W,h as X,r,m as ee,o as te,p as le,a as c,b as D,c as y,d as a,e as s,q as i,j as x,t as f,n as Y,l as w,s as ae,v as se,x as oe}from"./index-00ba39a0.js";import{u as ne}from"./dataUser-1f1c607a.js";import{d as q,a as de}from"./day-a01efc22.js";const o=T=>(se("data-v-46eb026a"),T=T(),oe(),T),ie={class:"grid"},ue={class:"col-12"},re={class:"card"},ce={class:"my-2"},pe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},me=o(()=>a("h5",{class:"m-0"},"Administrar dependientes",-1)),ve={class:"block mt-2 md:mt-0 p-input-icon-left"},_e=o(()=>a("i",{class:"pi pi-search"},null,-1)),fe=o(()=>a("span",{class:"p-column-title"},"DNI",-1)),be=o(()=>a("span",{class:"p-column-title"},"Name",-1)),he=o(()=>a("span",{class:"p-column-title"},"Apellidos",-1)),De=o(()=>a("span",{class:"p-column-title"},"Fecha Nacimiento",-1)),ye=o(()=>a("span",{class:"p-column-title"},"Sexo",-1)),xe={class:"field"},ge=o(()=>a("label",{class:"mb-3"},"Tipo de documento",-1)),we={class:"formgrid grid"},Ie={class:"field-radiobutton col-4"},Ve=o(()=>a("label",{for:"dni"},"DNI",-1)),ke={class:"field-radiobutton col-4"},Ce=o(()=>a("label",{for:"ce"},"CE",-1)),Te={class:"field-radiobutton col-4"},Me=o(()=>a("label",{for:"pasaport"},"Pasaporte",-1)),Ne={class:"field"},Se={for:"dni"},Ue={key:0,class:"p-invalid"},Pe={class:"field"},Ye=o(()=>a("label",{for:"name"},"Nombre",-1)),qe={key:0,class:"p-invalid"},Be={class:"field"},Fe=o(()=>a("label",{for:"name"},"Apellidos",-1)),Ae={key:0,class:"p-invalid"},Ee={class:"formgrid grid"},Le={class:"field col"},Re=o(()=>a("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),$e={key:0,class:"p-invalid"},ze={class:"field col"},je=o(()=>a("label",{for:"sex"},"Sexo",-1)),Oe={class:"flex align-items-center justify-content-center"},Ge=o(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Ke={key:0},Ze={class:"flex align-items-center justify-content-center"},He=o(()=>a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Je={key:0},Qe={__name:"Dependents",setup(T){const I=W(),M=ne(),B=X(),p=r(null),g=r(!1),V=r(!1),k=r(!1),e=r({}),b=r(null),F=r(null),N=r({}),u=r(!1),A=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]);ee(()=>{K()}),te(async()=>{const n=B.user.username;await M.getUsersDependents(n).then(t=>{p.value=t.map(h=>{let d=q(h.birthDate,"DD MMMM YYYY");return h.birthDate=d,h})})});const E=()=>{e.value={},e.value.documentType="DNI",u.value=!1,g.value=!0},L=()=>{g.value=!1,u.value=!1},S=n=>e.value.documentType==="DNI"?/^\d{8}$/.test(n):e.value.documentType==="CE"?/^\d{9}$/.test(n):e.value.documentType==="Pasaporte"?/^[A-Za-z0-9]{5,20}$/.test(n):!0,R=async()=>{u.value=!0;const{name:n,surnames:t,dni:h,birthDate:d,sex:U,dependentId:_}=e.value;if(n&&n.trim()&&t&&h&&d&&U&&S(e.value.dni)){const m=B.user.userId;if(e.value.userId=m,e.value.birthDate=new Date(de(d)),_){const v=p.value.findIndex(C=>C.dependentId===_);v!==-1&&(await ae(_,e.value),e.value.birthDate=q(e.value.birthDate,"DD MMMM YYYY"),p.value[v]=e.value,I.add({severity:"success",summary:"Éxito",detail:"Dependiente Actualizado",life:3e3}))}else{const v=await M.addUsersDependents(e.value);console.log(v),v.dependentId?(e.value.dependentId=v.dependentId,e.value.birthDate=q(e.value.birthDate,"DD MMMM YYYY"),p.value.push(e.value),I.add({severity:"success",summary:"Éxito",detail:"Dependiente Registrado",life:3e3})):I.add({severity:"error",summary:"Error",detail:v,life:3e3})}g.value=!1,e.value={}}},$=n=>{e.value={...n},g.value=!0},z=n=>{e.value=n,V.value=!0},j=async()=>{p.value=p.value.filter(n=>n.dependentId!==e.value.dependentId),await M.deleteUserDependents(e.value.dependentId),V.value=!1,e.value={},I.add({severity:"success",summary:"Éxito",detail:"Dependiente eliminado",life:3e3})},O=()=>{k.value=!0},G=()=>{p.value=p.value.filter(t=>!b.value.includes(t)),b.value.map(t=>t.dependentId).forEach(async t=>{await M.deleteUserDependents(t)}),k.value=!1,b.value=null,I.add({severity:"success",summary:"Éxito",detail:"Dependientes eliminados",life:3e3})},K=()=>{N.value={global:{value:null,matchMode:le.CONTAINS}}};return(n,t)=>{const h=c("Toast"),d=c("Button"),U=c("Toolbar"),_=c("InputText"),m=c("Column"),v=c("DataTable"),C=c("RadioButton"),Z=c("Calendar"),H=c("Dropdown"),P=c("Dialog");return D(),y("div",ie,[a("div",ue,[a("div",re,[s(h),s(U,{class:"mb-4"},{start:i(()=>[a("div",ce,[s(d,{label:"Nuevo Dependiente",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:E}),s(d,{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:O,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),_:1}),s(v,{ref_key:"dt",ref:F,value:p.value,selection:b.value,"onUpdate:selection":t[1]||(t[1]=l=>b.value=l),dataKey:"dependentId",paginator:!0,rows:10,filters:N.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando del  {first} al {last} de {totalRecords} dependientes",responsiveLayout:"scroll"},{header:i(()=>[a("div",pe,[me,a("span",ve,[_e,s(_,{modelValue:N.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=l=>N.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:i(()=>[s(m,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(m,{field:"dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(l=>[fe,x(" "+f(l.data.dni),1)]),_:1}),s(m,{field:"name",header:"Name",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(l=>[be,x(" "+f(l.data.name),1)]),_:1}),s(m,{field:"surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(l=>[he,x(" "+f(l.data.surnames),1)]),_:1}),s(m,{field:"birthDate",header:"Fecha Nacimiento",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(l=>[De,x(" "+f(l.data.birthDate),1)]),_:1}),s(m,{field:"sex",header:"Sexo",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:i(l=>[ye,x(" "+f(l.data.sex),1)]),_:1}),s(m,{headerStyle:"min-width:10rem;"},{body:i(l=>[s(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:J=>$(l.data)},null,8,["onClick"]),s(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:J=>z(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),s(P,{visible:g.value,"onUpdate:visible":t[10]||(t[10]=l=>g.value=l),style:{width:"450px"},header:"Datos de usuario",modal:!0,class:"p-fluid"},{footer:i(()=>[s(d,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:L}),s(d,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:R})]),default:i(()=>[a("div",xe,[ge,a("div",we,[a("div",Ie,[s(C,{id:"dni",name:"option",value:"DNI",modelValue:e.value.documentType,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ve]),a("div",ke,[s(C,{id:"ce",name:"option",value:"CE",modelValue:e.value.documentType,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ce]),a("div",Te,[s(C,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.documentType,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.documentType=l)},null,8,["modelValue"]),Me])])]),a("div",Ne,[a("label",Se,f(e.value.documentType),1),s(_,{id:"name",modelValue:e.value.dni,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:Y({"p-invalid":u.value&&!e.value.dni||!S(e.value.dni)})},null,8,["modelValue","class"]),u.value&&!e.value.dni||!S(e.value.dni)?(D(),y("small",Ue,f(e.value.documentType)+" es requerido o formato inválido",1)):w("",!0)]),a("div",Pe,[Ye,s(_,{id:"name",modelValue:e.value.name,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:Y({"p-invalid":u.value&&!e.value.name})},null,8,["modelValue","class"]),u.value&&!e.value.name?(D(),y("small",qe,"Nombre es requerido.")):w("",!0)]),a("div",Be,[Fe,s(_,{id:"name",modelValue:e.value.surnames,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:Y({"p-invalid":u.value&&!e.value.surnames})},null,8,["modelValue","class"]),u.value&&!e.value.surnames?(D(),y("small",Ae,"Apellido es requerido.")):w("",!0)]),a("div",Ee,[a("div",Le,[Re,s(Z,{showIcon:!0,showButtonBar:!0,modelValue:e.value.birthDate,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),u.value&&!e.value.birthDate?(D(),y("small",$e,"Fecha de nacimiento es requerido.")):w("",!0)]),a("div",ze,[je,s(H,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.sex=l),options:A.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),s(P,{visible:V.value,"onUpdate:visible":t[12]||(t[12]=l=>V.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[s(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[11]||(t[11]=l=>V.value=!1)}),s(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:j})]),default:i(()=>[a("div",Oe,[Ge,e.value?(D(),y("span",Ke,[x("¿Estás seguro de que quieres eliminar a "),a("b",null,f(e.value.name),1),x("?")])):w("",!0)])]),_:1},8,["visible"]),s(P,{visible:k.value,"onUpdate:visible":t[14]||(t[14]=l=>k.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[s(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[13]||(t[13]=l=>k.value=!1)}),s(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:G})]),default:i(()=>[a("div",Ze,[He,e.value?(D(),y("span",Je,"¿Está seguro de que desea eliminar los dependientes seleccionados?")):w("",!0)])]),_:1},8,["visible"])])])])}}},tt=Q(Qe,[["__scopeId","data-v-46eb026a"]]);export{tt as default};
