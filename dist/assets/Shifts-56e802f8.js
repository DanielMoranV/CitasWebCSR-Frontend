import{_ as ce,u as me,j as pe,A as he,r as n,q as ve,w as ye,o as _e,s as E,G as fe,a as m,b as C,d as H,e as s,l,v as d,m as p,t as r,n as be,C as G,f as K,h as Y,y as ge,z as we}from"./index-4af1a839.js";import{u as Ie}from"./dataAppointment-6c01be46.js";import{u as De}from"./dataAdmissionist-137fba89.js";import{u as Ce}from"./dataUser-fe915d66.js";import{d as S}from"./day-a01efc22.js";const c=g=>(ge("data-v-a0b25e3c"),g=g(),we(),g),Se={class:"grid"},Ae={class:"col-12"},Te={class:"card"},Me={class:"my-2"},Ne={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Pe=c(()=>s("h5",{class:"m-0"},"Citas Médicas",-1)),Ve={class:"block mt-2 md:mt-0 p-input-icon-left"},xe=c(()=>s("i",{class:"pi pi-search"},null,-1)),ke=c(()=>s("span",{class:"p-column-title"},"Nº Turno",-1)),Ee=c(()=>s("span",{class:"p-column-title"},"Paciente",-1)),Ye=c(()=>s("span",{class:"p-column-title"},"Estado",-1)),Fe=c(()=>s("span",{class:"p-column-title"},"Médico",-1)),Le=c(()=>s("span",{class:"p-column-title"},"Especialidad",-1)),Re=c(()=>s("span",{class:"p-column-title"},"Origen",-1)),Ue=c(()=>s("span",{class:"p-column-title"},"Fecha Consulta",-1)),$e={class:"flex align-items-center justify-content-center"},ze=c(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Be={key:0},Oe={class:"mb-1"},je={class:"mb-1"},qe={class:"mb-1"},He={class:"mb-1"},Ge={class:"field col-12 md:col-12 mt-12 mt-4"},Ke={class:"p-float-label"},Je=c(()=>s("label",{for:"autocomplete"},"Paciente",-1)),Qe={__name:"Shifts",setup(g){const A=me(),F=pe(),J=Ce(),Q=he(),L=De(),v=Ie(),R=n([]),w=n([]),i=n(null),U=n(null),f=n({}),T=n(null),I=n(!1),b=n(!1),$=n(!0),z=n(null),M=n(null),_=n(null),N=n(null),P=n(new Date),B=n([]),V=n(!0),x=n(null),O=n({amount:null,paymentDate:null,appointmentId:null,paymentMethodId:null,VoucherTypeId:null,userId:null});ve(()=>ee());const W=()=>U.value.exportCSV(),X=t=>{const a=t.query.toLowerCase();B.value=a.trim().length?M.value.filter(o=>o.fullName.toLowerCase().includes(a)):[...M.value]};ye(_,t=>{t!=null&&(V.value=!1)});const Z=async(t,a)=>{console.log(t.user.Doctor.doctorId,a),console.log(await v.getAppointmentDoctorIdByDay(t.user.Doctor.doctorId,S(a,"YYYY-MM-DD"))),w.value=await v.getAppointmentDoctorIdByDay(t.user.Doctor.doctorId,S(a,"YYYY-MM-DD")),j()};_e(async()=>{await Q.getDoctors().then(t=>{R.value=t.map(a=>(a.name=`${a.user.surnames} ${a.user.name}`,a))}),T.value=!1,z.value=await J.getPatients(),M.value=le(z.value),$.value=!1,x.value=await L.getTodayCashRegisterForAdmissionist(F.user.accessId)});const ee=()=>{f.value={global:{value:null,matchMode:E.CONTAINS},nameDoctor:{value:null,matchMode:E.IN},orderlyTurn:{operator:fe.AND,constraints:[{value:null,matchMode:E.DATE_IS}]}}},te=t=>{i.value=t,b.value=!0},ae=async()=>{await v.deleteAppointmentId(i.value.Appointment[0].appointmentId),b.value=!1,i.value={},A.add({severity:"success",summary:"Éxito",detail:"Cita médica eliminada",life:3e3})},se=async t=>{x.value!==null?(i.value=t,I.value=!0,V.value=!0,_.value=null):A.add({severity:"error",summary:"Error",detail:"Caja registradora NO APERTURADA",life:4e3})},oe=async()=>{const t=ne();let a=await v.addappointment(t);w.value=await v.getAppointment(),j();let o=await v.getLastPayment();o=Number(o.paymentId)+1,O.value={amount:Number(i.value.price)*100,voucherNumber:"000"+o,paymentDate:new Date,appointmentId:a.appointmentId,paymentMethodId:1,VoucherTypeId:5,userId:a.userId,admissionistId:F.user.accessId,chargeId:null};let u=await v.createPaymentCash(O.value),D={transactionDate:new Date,transactionType:"Ingreso",amount:u.amount,cashRegisterId:x.value.cashRegisterId,voucherNumber:u.voucherNumber,paymentId:u.paymentId,category:"Consultas Médicas"};await L.createCashRegisterTransaction(D),I.value=!1,A.add({severity:"success",summary:"Éxito",detail:"Cita médica pagada correctamente",life:3e3})};function j(){w.value.forEach(t=>{t.orderlyTurn=new Date(t.orderlyTurn),t.specialization=t.Schedule.doctor.specialization,t.nameDoctor=`${t.Schedule.doctor.user.surnames} ${t.Schedule.doctor.user.name}`,t.price=t.Schedule.doctor.personalizedPrices[0].personalizedPrice,t.Appointment[0]&&(t.status=t.Appointment[0].status,t.origin=t.Appointment[0].origin,t.Appointment[0].dependent?t.patient=`${t.Appointment[0].dependent.name} ${t.Appointment[0].dependent.surnames}`:t.patient=`${t.Appointment[0].user.name} ${t.Appointment[0].user.surnames}`)})}function le(t){const a=[];return t.forEach(o=>{a.push({userId:o.user.userId,fullName:o.user.name+" "+o.user.surnames+" "+o.user.dni,dependents:o.user.dependents,name:o.user.name,surnames:o.user.surnames,address:o.user.address,phone:o.user.phone}),o.user.dependents.length&&o.user.dependents.forEach(u=>{a.push({userId:u.userId,fullName:u.name+" "+u.surnames+" "+u.dni,dependentId:u.dependentId,name:o.user.name,surnames:o.user.surnames,address:o.user.address,phone:o.user.phone})})}),a}function ne(){return{origin:"admisión",status:"pendiente",createAt:new Date,doctorId:i.value.Schedule.doctor.doctorId,userId:_.value.userId,dependentId:_.value.dependentId,timeSlotId:i.value.timeSlotId,appointmentServices:{create:[{medicalServiceId:1}]}}}return(t,a)=>{const o=m("Toast"),u=m("Dropdown"),D=m("Calendar"),y=m("Button"),de=m("Toolbar"),ie=m("InputText"),h=m("Column"),re=m("DataTable"),q=m("Dialog"),ue=m("AutoComplete");return C(),H("div",Se,[s("div",Ae,[s("div",Te,[l(o),l(de,{class:"mb-4"},{start:d(()=>[s("div",Me,[l(u,{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),options:R.value,optionLabel:"name",placeholder:"Seleccionar Médico",class:"w-full md:w-14rem mr-4"},null,8,["modelValue","options"]),l(D,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),class:"mr-4 mt-4 md:mt-0"},null,8,["modelValue"]),l(y,{label:"Buscar",icon:"pi pi-search",class:"p-button-success mr-2 mt-4 md:mt-0",onClick:a[2]||(a[2]=e=>Z(N.value,P.value))})])]),end:d(()=>[l(y,{label:"Exportar",icon:"pi pi-upload",class:"p-button-help",onClick:a[3]||(a[3]=e=>W(e))})]),_:1}),l(re,{ref_key:"dt",ref:U,value:w.value,dataKey:"timeSlotId",paginator:!0,rows:10,rowHover:!0,filters:f.value,"onUpdate:filters":a[5]||(a[5]=e=>f.value=e),filterDisplay:"menu",loading:T.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando del  {first} al {last} de {totalRecords} Atenciones",globalFilterFields:["nTurn","patient","status","nameDoctor","status","specialization","orderlyTurn","origin"],responsiveLayout:"scroll"},{header:d(()=>[s("div",Ne,[Pe,s("span",Ve,[xe,l(ie,{modelValue:f.value.global.value,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.global.value=e),placeholder:"Buscar..."},null,8,["modelValue"])])])]),empty:d(()=>[p("No se encontraron citas médicas ")]),loading:d(()=>[p(" Cargando datos. Espere por favor. ")]),default:d(()=>[l(h,{field:"nTurn",header:"Nº Turno",sortable:!0,headerStyle:"width:10%; min-width:2rem;"},{body:d(e=>[ke,p(" "+r(e.data.nTurn),1)]),_:1}),l(h,{field:"patient",header:"Paciente",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(e=>[Ee,p(" "+r(e.data.patient),1)]),_:1}),l(h,{field:"status",header:"Estado",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(e=>[Ye,s("span",{class:be("user-badge status-"+(e.data.status?e.data.status.toLowerCase():""))},r(e.data.status||"Disponible"),3)]),_:1}),l(h,{field:"nameDoctor",header:"Habilitado",sortable:!0,showFilterMatchModes:!1,headerStyle:"width:14%; min-width:10rem;"},{body:d(e=>[Fe,p(" "+r(e.data.Schedule.availableSchedule),1)]),_:1}),l(h,{field:"specialization",header:"Especialidad",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(e=>[Le,p(" "+r(e.data.specialization),1)]),_:1}),l(h,{field:"origin",header:"Origen",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(e=>[Re,p(" "+r(e.data.origin),1)]),_:1}),l(h,{field:"orderlyTurn",header:"Fecha Consulta",showFilterMatchModes:!1,sortable:!0,headerStyle:"width:15%; min-width:10rem;"},{body:d(e=>[Ue,p(" "+r(G(S)(e.data.orderlyTurn,"DD MMMM YYYY hh:mm a")),1)]),filter:d(({filterModel:e})=>[l(D,{modelValue:e.value,"onUpdate:modelValue":k=>e.value=k,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(h,{headerStyle:"width:10%; min-width:5rem;",header:"Acciones"},{body:d(e=>[e.data.status?(C(),K(y,{key:0,icon:"pi pi-trash",class:"p-button-rounded p-button-danger mt-2 mr-2",onClick:k=>te(e.data)},null,8,["onClick"])):Y("",!0),e.data.status?Y("",!0):(C(),K(y,{key:1,icon:"pi pi-calendar-plus",class:"p-button-rounded p-button-success mt-2",onClick:k=>se(e.data)},null,8,["onClick"]))]),_:1})]),_:1},8,["value","filters","loading"]),l(q,{visible:b.value,"onUpdate:visible":a[7]||(a[7]=e=>b.value=e),style:{width:"450px"},header:"Eliminar Cita",modal:!0},{footer:d(()=>[l(y,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[6]||(a[6]=e=>b.value=!1)}),l(y,{label:"Si",icon:"pi pi-check",class:"p-button-text",onClick:ae})]),default:d(()=>[s("div",$e,[ze,i.value?(C(),H("span",Be,[p("Estás seguro de que quieres eliminar atención Nº "),s("b",null,r(i.value.Appointment[0].appointmentId),1),p("?")])):Y("",!0)])]),_:1},8,["visible"]),l(q,{visible:I.value,"onUpdate:visible":a[10]||(a[10]=e=>I.value=e),style:{width:"450px"},header:"Agendar Consulta Médica",modal:!0,class:"grid p-fluid"},{default:d(()=>[s("p",Oe,"Medico : "+r(i.value?i.value.nameDoctor:"No disponible"),1),s("p",je,"Especialidad : "+r(i.value?i.value.specialization:"No disponible"),1),s("p",qe,"Fecha: "+r(i.value?G(S)(i.value.orderlyTurn,"DD MMMM YYYY hh:mm A"):"No disponible"),1),s("p",He,"Total : S/ "+r(i.value?i.value.price:"No disponible"),1),s("div",Ge,[s("span",Ke,[l(ue,{id:"patients",dropdown:!0,modelValue:_.value,"onUpdate:modelValue":a[8]||(a[8]=e=>_.value=e),suggestions:B.value,onComplete:a[9]||(a[9]=e=>X(e)),field:"fullName",disabled:$.value},null,8,["modelValue","suggestions","disabled"]),Je])]),l(y,{label:"Pagar Consulta Médica",icon:"pi pi-money-bill",class:"p-button-default col-12 mb-2",disabled:V.value,loading:T.value,onClick:oe},null,8,["disabled","loading"])]),_:1},8,["visible"])])])])}}},at=ce(Qe,[["__scopeId","data-v-a0b25e3c"]]);export{at as default};
