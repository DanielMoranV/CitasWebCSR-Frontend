import{_ as de,u as ue,h as re,r,w as ce,m as me,o as pe,p as ve,a as m,b as f,c as h,d as t,e as o,q as d,j as I,t as _,n as P,l as D,v as fe,x as he}from"./index-fa8ea927.js";import{u as _e}from"./dataUser-88239523.js";import{d as $,a as be}from"./day-a01efc22.js";import{r as ye,u as Ie}from"./xlsx-04f2268f.js";const n=k=>(fe("data-v-390f97a5"),k=k(),he(),k),De={class:"grid"},ge={class:"col-12"},xe={class:"card"},Ve={class:"my-2"},we={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Se=n(()=>t("h5",{class:"m-0"},"Gestión de usuarios",-1)),Ue={class:"block mt-2 md:mt-0 p-input-icon-left"},ke=n(()=>t("i",{class:"pi pi-search"},null,-1)),Ce=n(()=>t("span",{class:"p-column-title"},"DNI",-1)),Te=n(()=>t("span",{class:"p-column-title"},"Nombre",-1)),Ne=n(()=>t("span",{class:"p-column-title"},"Apellidos",-1)),Pe=n(()=>t("span",{class:"p-column-title"},"Fecha Nacimiento",-1)),Me=n(()=>t("span",{class:"p-column-title"},"Teléfono",-1)),Fe={class:"field"},qe=n(()=>t("label",{class:"mb-3"},"Tipo de documento",-1)),Ae={class:"formgrid grid"},Be={class:"field-radiobutton col-4"},Ee=n(()=>t("label",{for:"dni"},"DNI",-1)),Le={class:"field-radiobutton col-4"},Ye=n(()=>t("label",{for:"ce"},"CE",-1)),$e={class:"field-radiobutton col-4"},je=n(()=>t("label",{for:"pasaport"},"Pasaporte",-1)),ze={class:"field"},Re={for:"dni"},Ge={key:0,class:"p-invalid"},Oe={class:"field"},Ke=n(()=>t("label",{for:"name"},"Nombre",-1)),Ze={key:0,class:"p-invalid"},He={class:"field"},Je=n(()=>t("label",{for:"name"},"Apellidos",-1)),Qe={key:0,class:"p-invalid"},We={class:"formgrid grid"},Xe={class:"field col"},ea=n(()=>t("label",{for:"birthDate"},"Fecha de Nacimiento",-1)),aa={key:0,class:"p-invalid"},la={class:"field col"},sa=n(()=>t("label",{for:"phone"},"Teléfono",-1)),ta={key:0,class:"p-invalid"},oa={class:"formgrid grid"},na={class:"field col"},ia=n(()=>t("label",{for:"sex"},"Sexo",-1)),da={class:"field col"},ua=n(()=>t("label",{for:"role"},"Estado Civil",-1)),ra={class:"flex align-items-center justify-content-center"},ca=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ma={key:0},pa={class:"flex align-items-center justify-content-center"},va=n(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),fa={key:0},ha={__name:"Patients",setup(k){const g=ue(),j=re(),V=_e(),L=r(null),w=r(!0),c=r([]),e=r({}),x=r(!1),S=r(!1),U=r(!1),b=r(null),M=r(null),C=r({}),u=r(!1),z=r([{name:"Masculino",code:"Masculino"},{name:"Femenino",code:"Femenino"}]),R=r([{name:"Soltero",code:"Soltero"},{name:"Casado",code:"Casado"},{name:"Viudo",code:"Viudo"},{name:"Divorciado",code:"Divorciado"}]);ce([()=>e.value.dni],async([s])=>{T(s)&&e.value.documentType==="DNI"&&G(s)});const G=async s=>{const a=await j.searchbydni(s);a?(e.value.name=(a==null?void 0:a.nombres)||"",e.value.surnames=(a==null?void 0:a.apellidop)+" "+(a==null?void 0:a.apellidom),g.add({severity:"success",summary:"Éxito",detail:"DNI encontrado",life:3e3})):(e.value.dni="",e.value.name="",e.value.surnames="",g.add({severity:"error",summary:"Error",detail:"DNI no encontrado; intente nuevamente",life:3e3}))},F=s=>/^[0-9]{9}$/.test(s),T=s=>e.value.documentType==="DNI"?(w.value=!0,/^\d{8}$/.test(s)):e.value.documentType==="CE"?(w.value=!1,/^\d{9}$/.test(s)):e.value.documentType==="Pasaporte"?(w.value=!1,/^[A-Za-z0-9]{5,20}$/.test(s)):!0;me(()=>{oe()});const O=`listpatients-${$(new Date,"DD-MM-YYYY")}`;pe(async()=>{await V.getPatients().then(s=>{L.value=s.flatMap(a=>[{accessId:a.accessId,user:a.user},...(a.user.dependents||[]).map(i=>({accessId:i.accessId,user:i}))])}),L.value.forEach(s=>{const a=s.user;let p=$(a.birthDate,"DD MMMM YYYY");a.birthDate=p,a.accessId=s.accessId,c.value.push(a)}),console.log(c.value)});const K=()=>{e.value={accessId:null,address:null,birthDate:null,civilStatus:null,dni:null,documentType:"DNI",email:null,name:null,phone:null,photo:null,sex:null,surnames:null,userId:null},u.value=!1,x.value=!0},Z=()=>{x.value=!1,u.value=!1},H=()=>{const s=e.value;return s.name&&s.name.trim()&&s.surnames&&s.dni&&s.birthDate&&s.sex&&T(s.dni)&&F(s.phone)},J=async()=>{const s={address:e.value.address,birthDate:be(new Date(e.value.birthDate)),civilStatus:e.value.civilStatus,dni:e.value.dni,documentType:e.value.documentType,email:e.value.email,name:e.value.name,phone:e.value.phone,photo:e.value.photo,sex:e.value.sex,surnames:e.value.surnames,access:{username:`${e.value.dni}`,password:e.value.dni,roleId:4}};if(e.value.accessId){const a=c.value.findIndex(p=>p.accessId===e.value.accessId);a!==-1&&(s.access.accessId=e.value.accessId,s.userId=e.value.userId,await V.updateUser(s.dni,s.access.accessId,s),c.value[a]=e.value,g.add({severity:"success",summary:"Éxito",detail:"Colaborador Actualizado",life:3e3}))}else{const a=await V.addUsers(s);e.value.accessId=a.access[0].accessId,e.value.status="offline",c.value.push(e.value),g.add({severity:"success",summary:"Éxito",detail:"Colaborador Registrado",life:3e3})}x.value=!1,e.value={},u.value=!1},Q=async()=>{u.value=!0,H()&&J()},W=s=>{e.value={...s},x.value=!0},X=s=>{e.value=s,S.value=!0},ee=async()=>{console.log(e.value),e.value.accessId==null?(c.value=c.value.filter(s=>s.dni!==e.value.dni),await V.deleteUserDependents(e.value.dependentId)):(c.value=c.value.filter(s=>s.accessId!==e.value.accessId),await V.disableUser(e.value.accessId)),console.log(e.value),S.value=!1,e.value={},g.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3})},ae=()=>{console.log(M.value),M.value.exportCSV()},le=s=>{const a=s.files[0],p=new FileReader;p.onload=i=>{const q=new Uint8Array(i.target.result),N=ye(q,{type:"array"}),y=N.SheetNames[0],v=N.Sheets[y],A=Ie.sheet_to_json(v);console.log(A)},p.readAsArrayBuffer(a)},se=()=>{U.value=!0},te=()=>{c.value=c.value.filter(a=>!b.value.includes(a)),b.value.map(a=>a.dni).forEach(async a=>{console.log(a)}),U.value=!1,b.value=null,g.add({severity:"success",summary:"Successful",detail:"Pacientes deshabilitados",life:3e3})},oe=()=>{C.value={global:{value:null,matchMode:ve.CONTAINS}}};return(s,a)=>{const p=m("Toast"),i=m("Button"),q=m("FileUpload"),N=m("Toolbar"),y=m("InputText"),v=m("Column"),A=m("DataTable"),B=m("RadioButton"),ne=m("Calendar"),Y=m("Dropdown"),E=m("Dialog");return f(),h("div",De,[t("div",ge,[t("div",xe,[o(p),o(N,{class:"mb-4"},{start:d(()=>[t("div",Ve,[o(i,{label:"Nuevo",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:K}),o(i,{label:"Deshabilitar",icon:"pi pi-trash",class:"p-button-danger",onClick:se,disabled:!b.value||!b.value.length},null,8,["disabled"])])]),end:d(()=>[o(q,{mode:"basic",accept:".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",auto:!0,maxFileSize:1e6,label:"Importar",chooseLabel:"Importar",class:"mr-2 inline-block",onUpload:le}),o(i,{label:"Export",icon:"pi pi-upload",class:"p-button-help",onClick:a[0]||(a[0]=l=>ae(l))})]),_:1}),o(A,{ref_key:"dt",ref:M,value:c.value,selection:b.value,"onUpdate:selection":a[2]||(a[2]=l=>b.value=l),dataKey:"dni",paginator:!0,rows:10,filters:C.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} Pacientes",responsiveLayout:"scroll",exportFilename:O},{header:d(()=>[t("div",we,[Se,t("span",Ue,[ke,o(y,{modelValue:C.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=l=>C.value.global.value=l),placeholder:"Buscar..."},null,8,["modelValue"])])])]),default:d(()=>[o(v,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(v,{field:"user.dni",header:"DNI",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ce,I(" "+_(l.data.dni),1)]),_:1}),o(v,{field:"user.name",header:"Nombre",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Te,I(" "+_(l.data.name),1)]),_:1}),o(v,{field:"user.surnames",header:"Apellidos",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Ne,I(" "+_(l.data.surnames),1)]),_:1}),o(v,{field:"roleName",header:"Fecha de Nacimiento",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Pe,I(" "+_(l.data.birthDate),1)]),_:1}),o(v,{field:"status",header:"Teléfono",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:d(l=>[Me,I(" "+_(l.data.phone),1)]),_:1}),o(v,{headerStyle:"min-width:10rem;",header:"Acciones"},{body:d(l=>[o(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:ie=>W(l.data)},null,8,["onClick"]),o(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:ie=>X(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),o(E,{visible:x.value,"onUpdate:visible":a[13]||(a[13]=l=>x.value=l),style:{width:"500px"},header:"Detalle de colaborador",modal:!0,class:"p-fluid"},{footer:d(()=>[o(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:Z}),o(i,{label:"Guardar",icon:"pi pi-check",class:"p-button-text",onClick:Q})]),default:d(()=>[t("div",Fe,[qe,t("div",Ae,[t("div",Be,[o(B,{id:"dni",name:"option",value:"DNI",modelValue:e.value.documentType,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ee]),t("div",Le,[o(B,{id:"ce",name:"option",value:"CE",modelValue:e.value.documentType,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.documentType=l)},null,8,["modelValue"]),Ye]),t("div",$e,[o(B,{id:"pasaport",name:"option",value:"Pasaporte",modelValue:e.value.documentType,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.documentType=l)},null,8,["modelValue"]),je])])]),t("div",ze,[t("label",Re,_(e.value.documentType),1),o(y,{id:"name",modelValue:e.value.dni,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.dni=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":u.value&&!e.value.dni||!T(e.value.dni)})},null,8,["modelValue","class"]),u.value&&!e.value.dni||!T(e.value.dni)?(f(),h("small",Ge,_(e.value.documentType)+" es requerido o formato inválido",1)):D("",!0)]),t("div",Oe,[Ke,o(y,{disabled:w.value,id:"name",modelValue:e.value.name,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":u.value&&!e.value.name})},null,8,["disabled","modelValue","class"]),u.value&&!s.user.name?(f(),h("small",Ze,"Nombre es requerido.")):D("",!0)]),t("div",He,[Je,o(y,{disabled:w.value,id:"name",modelValue:e.value.surnames,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.surnames=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:P({"p-invalid":u.value&&!e.value.surnames})},null,8,["disabled","modelValue","class"]),u.value&&!e.value.surnames?(f(),h("small",Qe,"Apellido es requerido.")):D("",!0)]),t("div",We,[t("div",Xe,[ea,o(ne,{showIcon:!0,showButtonBar:!0,modelValue:e.value.birthDate,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.birthDate=l),dateFormat:"dd/mm/yy",required:"true"},null,8,["modelValue"]),u.value&&!s.user.birthDate?(f(),h("small",aa,"Fecha de nacimiento es requerido.")):D("",!0)]),t("div",la,[sa,o(y,{id:"phone",modelValue:e.value.phone,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.phone=l),modelModifiers:{trim:!0},class:P({"p-invalid":u.value&&!e.value.phone||!F(e.value.phone)})},null,8,["modelValue","class"]),u.value&&!e.value.phone||!F(e.value.phone)?(f(),h("small",ta," Teléfono es requerido o formato inválido")):D("",!0)])]),t("div",oa,[t("div",na,[ia,o(Y,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.sex=l),options:z.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])]),t("div",da,[ua,o(Y,{id:"civilStatus",modelValue:e.value.civilStatus,"onUpdate:modelValue":a[12]||(a[12]=l=>e.value.civilStatus=l),options:R.value,optionLabel:"name",placeholder:"Selecciona",optionValue:"code"},null,8,["modelValue","options"])])])]),_:1},8,["visible"]),o(E,{visible:S.value,"onUpdate:visible":a[15]||(a[15]=l=>S.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[14]||(a[14]=l=>S.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:ee})]),default:d(()=>[t("div",ra,[ca,e.value?(f(),h("span",ma,[I("¿Estás seguro de que quieres eliminar "),t("b",null,_(e.value.name),1),I("?")])):D("",!0)])]),_:1},8,["visible"]),o(E,{visible:U.value,"onUpdate:visible":a[17]||(a[17]=l=>U.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[o(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[16]||(a[16]=l=>U.value=!1)}),o(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:te})]),default:d(()=>[t("div",pa,[va,e.value?(f(),h("span",fa,"¿Está seguro de que desea eliminar los usuarios seleccionados?")):D("",!0)])]),_:1},8,["visible"])])])])}}},Da=de(ha,[["__scopeId","data-v-390f97a5"]]);export{Da as default};
