import{r as u,j as T,p as M,u as P,o as C,D,a as v,b as q,d as w,e as t,l as y,t as i,C as x,F as k}from"./index-4af1a839.js";import{u as N}from"./dataAppointment-6c01be46.js";import{d as h}from"./day-a01efc22.js";const S=t("div",{class:"flex align-items-center py-5 px-3"},[t("i",{class:"pi pi-fw pi-money-bill mr-2 text-2xl"}),t("p",{class:"m-0 text-lg"},"Pago de consultas médicas")],-1),z={class:"grid justify-content-center"},Y={class:"col-12 md:col-6 lg:col-5 p-0 lg:pr-5 lg:pb-5 mt-4 lg:mt-0"},A={style:{padding:"2px","border-radius":"10px",background:"linear-gradient(90deg, rgba(145, 210, 204, 0.2), rgba(212, 162, 221, 0.2)), linear-gradient(180deg, rgba(251, 199, 145, 0.2), rgba(160, 210, 250, 0.2))"}},E={class:"p-3 surface-card h-full",style:{"border-radius":"8px"}},B={class:"mt-3 mb-1"},V={class:"mb-1"},$={class:"mb-1"},j={class:"mb-1"},U={__name:"Payment",setup(F){const a=u(null),n=N(),s=T(),r=M(),c=P(),e=u(null),_=u(!1),b=u(null),p=u(!0),d=u({amount:null,paymentDate:null,appointmentId:null,paymentMethodId:null,VoucherTypeId:null,userId:null}),g=async()=>{Culqi.settings({title:"CSR Consultas Web",currency:"PEN",amount:d.value.amount*100}),Culqi.open()};C(async()=>{const o=document.createElement("script");o.src="https://checkout.culqi.com/js/v4",o.async=!0,o.onload=()=>{Culqi.publicKey="pk_test_73e0f77c30643c37",p.value=!1},document.body.appendChild(o),e.value=await n.getAppointmentId(n.appointment.appointmentId);const l=e.value.dependentId?`${e.value.dependent.name} ${e.value.dependent.surnames}`:`${e.value.user.name} ${e.value.user.surnames}`;e.value.patient=l,d.value={amount:e.value.doctor.personalizedPrices[0].personalizedPrice,paymentDate:new Date,appointmentId:n.appointment.appointmentId,paymentMethodId:2,VoucherTypeId:b.value,userId:s.user.user.userId},window.addEventListener("culqiTokenCreated",m)}),D(()=>{window.removeEventListener("culqiTokenCreated",m),window.location.reload()});const m=async o=>{a.value=o.detail,a.value.metadata={},a.value.metadata.appointmentId=n.appointment.appointmentId,a.value.metadata.paymentMethodId=2,a.value.metadata.VoucherTypeId=5,a.value.metadata.paymentDate=d.value.paymentDate,a.value.metadata.userId=s.user.user.userId,a.value.metadata.amount=d.value.amount*100,a.value.client.address=s.user.user.address,a.value.client.phone=s.user.user.phone,a.value.client.name=s.user.user.name,a.value.client.surnames=s.user.user.surnames,a.value.dataPayment={nameDoctor:e.value.doctor.user.name+" "+e.value.doctor.user.surnames,specialty:e.value.doctor.specialization,patient:e.value.patient,date:h(e.value.timeSlot.orderlyTurn,"DD MMMM YYYY hh:mm A"),price:e.value.doctor.personalizedPrices[0].personalizedPrice};const l=await n.addPayment(a.value);console.log(l),l.message?(c.add({severity:"error",summary:"Error",detail:l.message,life:4e3}),await n.deleteAppointmentId(n.appointment.appointmentId),Culqi.close(),a.value={},setTimeout(()=>r.push("/quotes"),4e3)):(c.add({severity:"success",summary:"Éxito",detail:"Pago realizado correctamente",life:4e3}),Culqi.close(),setTimeout(()=>r.push("/quote/confirmation"),1e3))};return(o,l)=>{const f=v("Toast"),I=v("Button");return q(),w(k,null,[S,t("div",z,[y(f),t("div",Y,[t("div",A,[t("div",E,[t("p",B,"Medico : "+i(e.value?e.value.doctor.user.name+" "+e.value.doctor.user.surnames:"No disponible"),1),t("p",V,"Especialidad : "+i(e.value?e.value.doctor.specialization:"No disponible"),1),t("p",$,"Paciente : "+i(e.value?e.value.patient:"No disponible"),1),t("p",j,"Tipo de servicio : "+i(e.value?e.value.appointmentServices[0].medicalService.name:"No disponible"),1),t("span",null,"Fecha: "+i(e.value?x(h)(e.value.timeSlot.orderlyTurn,"DD MMMM YYYY hh:mm A"):"No disponible"),1),t("p",null,"Total: "+i(e.value?e.value.doctor.personalizedPrices[0].personalizedPrice:"No disponible"),1),y(I,{label:"Método de pago",icon:"pi pi-money-bill",class:"p-button-success col-12",disabled:p.value,loading:_.value,onClick:g},null,8,["disabled","loading"])])])])])],64)}}};export{U as default};
